# âœ… MineCLIP 16å¸§è§†é¢‘æ¨¡å¼ - å·²å®Œæˆå®æ–½

> **å®Œæˆæ—¶é—´**: 2025-10-21  
> **ç›®æ ‡**: å»ºç«‹é€šç”¨MineCLIPå¥–åŠ±æ¡†æ¶ï¼Œå®ç°ä»»æ„æŠ€èƒ½è‡ªä¸»å­¦ä¹   
> **çŠ¶æ€**: ä»£ç æ”¹é€ å®Œæˆï¼Œå¾…éªŒè¯æ•ˆæœ â³

---

## ğŸ‰ **å·²å®Œæˆçš„å·¥ä½œ**

### **1. æ ¸å¿ƒä»£ç æ”¹é€ ** âœ…

| æ–‡ä»¶ | æ”¹åŠ¨ | è¯´æ˜ |
|------|------|------|
| `src/utils/mineclip_reward.py` | æ–°å¢16å¸§è§†é¢‘æ”¯æŒ | å¸§ç¼“å†²ã€è§†é¢‘ç¼–ç ã€å®˜æ–¹MineCLIPæµç¨‹ |
| `src/training/train_get_wood.py` | æ–°å¢è§†é¢‘æ¨¡å¼å‚æ•° | `--use-video-mode`, `--num-frames`, `--compute-frequency` |
| `scripts/train_get_wood.sh` | ï¼ˆå¾…æ›´æ–°ï¼‰ | éœ€æ·»åŠ è§†é¢‘æ¨¡å¼å‚æ•°æ”¯æŒ |

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… 16å¸§æ»šåŠ¨çª—å£ï¼ˆ`deque`ï¼‰
- âœ… ç¨€ç–è®¡ç®—ï¼ˆæ¯Næ­¥è®¡ç®—ä¸€æ¬¡MineCLIPï¼‰
- âœ… MineCraftå®˜æ–¹å½’ä¸€åŒ–å‚æ•°
- âœ… å®Œæ•´çš„`encode_video`æµç¨‹
- âœ… åŠ¨æ€ä»»åŠ¡æè¿°ï¼ˆè§†é¢‘æ¨¡å¼ç”¨åŠ¨ä½œæè¿°ï¼‰

### **2. éªŒè¯å·¥å…·** âœ…

| å·¥å…· | åŠŸèƒ½ | ç”¨é€” |
|------|------|------|
| `record_chopping_sequence.py` | å½•åˆ¶ç æ ‘è¿‡ç¨‹ | è·å–çœŸå®çš„16å¸§è¿ç»­åºåˆ— |
| `verify_mineclip_16frames.py` | åˆ†æ16å¸§è§†é¢‘æ•ˆæœ | è®¡ç®—ç›¸ä¼¼åº¦ã€ç»Ÿè®¡åˆ†æã€å¯è§†åŒ– |
| `quick_verify.sh` | ä¸€é”®éªŒè¯è„šæœ¬ | 3ç§éªŒè¯æ¨¡å¼ï¼Œäº¤äº’å¼é€‰æ‹© |

### **3. æ–‡æ¡£** âœ…

- `MINECLIP_16FRAMES_GUIDE.md` - å®Œæ•´ä½¿ç”¨æŒ‡å—
- `UNIVERSAL_MINECLIP_STRATEGY.md` - é€šç”¨æ¡†æ¶æˆ˜ç•¥
- `IMPLEMENTATION_PLAN.md` - å®æ–½è®¡åˆ’ï¼ˆ3é˜¶æ®µï¼‰

---

## ğŸš€ **ç«‹å³å¼€å§‹éªŒè¯**

ä½ ç°åœ¨å¯ä»¥**å½•åˆ¶ç æ ‘è¿‡ç¨‹**æ¥éªŒè¯16å¸§MineCLIPæ•ˆæœï¼

### **æœ€ç®€å•çš„æ–¹å¼ - ä½¿ç”¨å¿«æ·è„šæœ¬**

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
conda activate minedojo-x86

# 2. è¿è¡Œå¿«æ·è„šæœ¬
./quick_verify.sh

# 3. é€‰æ‹©æ¨¡å¼2ï¼ˆå½•åˆ¶æ–°çš„ç æ ‘åºåˆ—ï¼‰
```

### **æ‰‹åŠ¨æ–¹å¼**

```bash
# æ­¥éª¤1: å½•åˆ¶ç æ ‘è¿‡ç¨‹
python record_chopping_sequence.py \
    --output-dir logs/my_chopping \
    --max-frames 500

# æ­¥éª¤2: éªŒè¯æ•ˆæœ
python verify_mineclip_16frames.py \
    --sequence-dir logs/my_chopping \
    --task-prompt "chopping a tree with hand"

# æ­¥éª¤3: æŸ¥çœ‹ç»“æœ
cat logs/my_chopping/similarity_results.txt
open logs/my_chopping/similarity_analysis.png
```

---

## ğŸ“Š **é¢„æœŸç»“æœè§£è¯»**

éªŒè¯è„šæœ¬ä¼šè¾“å‡ºï¼š

```
ğŸ“Š ç›¸ä¼¼åº¦ç»Ÿè®¡:
  æœ€å°å€¼: 0.xxxx
  æœ€å¤§å€¼: 0.xxxx
  å˜åŒ–èŒƒå›´: 0.xxxx  â† ğŸ”‘ å…³é”®æŒ‡æ ‡

ğŸ¯ è¯„ä¼°ç»“è®º:
  [è‡ªåŠ¨åˆ¤æ–­]
```

**åˆ¤æ–­æ ‡å‡†**:

| å˜åŒ–èŒƒå›´ | è¯„ä¼° | å»ºè®® |
|---------|------|------|
| > 0.05 | âœ… ä¼˜ç§€ | ç«‹å³ä½¿ç”¨16å¸§æ¨¡å¼è®­ç»ƒ |
| 0.02-0.05 | âš ï¸  å¯ç”¨ | å°è¯•è°ƒæ•´æç¤ºè¯ |
| < 0.02 | âŒ æ•ˆæœå·® | è€ƒè™‘æ··åˆå¥–åŠ±æˆ–ä»»åŠ¡åˆ†è§£ |

---

## ğŸ¯ **æ ¸å¿ƒæ€æƒ³**

### **ä¸ºä»€ä¹ˆéœ€è¦16å¸§è§†é¢‘æ¨¡å¼ï¼Ÿ**

```
å•å¸§MineCLIP:
  è¾“å…¥: ä¸€å¼ å›¾ â†’ "çœ‹åˆ°ä¸€æ£µæ ‘"
  åŒºåˆ†åº¦: 0.007 âŒ
  é—®é¢˜: æ— æ³•ç†è§£"åŠ¨ä½œ"

16å¸§MineCLIP:
  è¾“å…¥: 16å¸§è§†é¢‘ â†’ "æ­£åœ¨ç æ ‘"
  åŒºåˆ†åº¦: ??? â³ å¾…éªŒè¯
  ä¼˜åŠ¿: ç†è§£åŠ¨ä½œå’Œè¿‡ç¨‹
```

### **å®˜æ–¹MineCLIPçš„è®¾è®¡**

MineCLIPè®­ç»ƒåœ¨280ä¸‡YouTube Minecraftè§†é¢‘ä¸Šï¼š
1. è¾“å…¥ï¼š16å¸§è¿ç»­åºåˆ— `[1, 16, 3, H, W]`
2. å¤„ç†ï¼š`forward_image_features()` (æ¯å¸§) + `forward_video_features()` (æ—¶åºèšåˆ)
3. è¾“å‡ºï¼šç†è§£"åŠ¨ä½œ"çš„è§†é¢‘ç‰¹å¾

**æˆ‘ä»¬ä¹‹å‰çš„å•å¸§æ¨¡å¼è·³è¿‡äº†ç¬¬2æ­¥ï¼Œæ‰€ä»¥æ•ˆæœå·®ï¼**

---

## ğŸ“ **å…³é”®å‚æ•°è¯´æ˜**

### **è®­ç»ƒå‚æ•°**

```bash
# å¯ç”¨16å¸§è§†é¢‘æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
--use-video-mode

# ç¦ç”¨ï¼ˆå›é€€åˆ°å•å¸§æ¨¡å¼ï¼‰
--no-video-mode

# è§†é¢‘å¸§æ•°ï¼ˆé»˜è®¤16ï¼Œå®˜æ–¹æ ‡å‡†ï¼‰
--num-frames 16

# è®¡ç®—é¢‘ç‡ï¼ˆæ¯Næ­¥è®¡ç®—ä¸€æ¬¡MineCLIPï¼‰
--compute-frequency 4
# - å€¼è¶Šå°ï¼Œå¥–åŠ±è¶Šé¢‘ç¹ï¼Œä½†å¼€é”€è¶Šå¤§
# - æ¨èï¼š2-8ä¹‹é—´
# - é»˜è®¤4ï¼šå¹³è¡¡æ•ˆæœå’Œæ€§èƒ½
```

### **ä»»åŠ¡æè¿°**

```python
# è§†é¢‘æ¨¡å¼ï¼šä½¿ç”¨åŠ¨ä½œæè¿°
task_prompt = "chopping a tree with hand"  âœ…
task_prompt = "punching a tree trunk"      âœ…
task_prompt = "mining wood with hand"      âœ…

# å•å¸§æ¨¡å¼ï¼šä½¿ç”¨è§†è§‰æè¿°
task_prompt = "tree"                       âœ…
task_prompt = "oak tree in minecraft"      âœ…

# é¿å…è¿‡äºå¤æ‚çš„æè¿°
task_prompt = "a player is using their hand to chop down..."  âŒ
```

---

## ğŸ”„ **å®Œæ•´å·¥ä½œæµç¨‹**

```mermaid
graph TD
    A[å½•åˆ¶ç æ ‘åºåˆ—] -->|500å¸§| B[16å¸§æ»‘åŠ¨çª—å£åˆ†æ]
    B -->|ç›¸ä¼¼åº¦ç»Ÿè®¡| C{å˜åŒ–èŒƒå›´åˆ¤æ–­}
    
    C -->|> 0.05| D[âœ… 16å¸§æ¨¡å¼è®­ç»ƒ]
    C -->|0.02-0.05| E[âš ï¸ è°ƒæ•´æç¤ºè¯]
    C -->|< 0.02| F[âŒ è€ƒè™‘å…¶ä»–æ–¹æ¡ˆ]
    
    D --> G[10000æ­¥æµ‹è¯•]
    G --> H{è®­ç»ƒç¨³å®šï¼Ÿ}
    H -->|æ˜¯| I[100000æ­¥å®Œæ•´è®­ç»ƒ]
    H -->|å¦| J[è°ƒæ•´å‚æ•°]
    
    E --> K[æµ‹è¯•ä¸åŒtask_prompt]
    K --> B
    
    F --> L[æ··åˆå¥–åŠ±æ–¹æ¡ˆ]
    F --> M[ä»»åŠ¡åˆ†è§£ + åˆ†å±‚RL]
```

---

## ğŸ¬ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**

### **ç«‹å³è¡ŒåŠ¨ï¼ˆä½ æåˆ°çš„ï¼‰**

> "æˆ‘å¯ä»¥å½•åˆ¶ä¸€ä¸ªæˆ‘æ¥ç æ ‘çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œä¿å­˜è¿™äº›å¸§ç”»é¢è¿›è¡ŒéªŒè¯"

**å®Œç¾ï¼** è¿™æ˜¯æœ€å¥½çš„éªŒè¯æ–¹å¼ã€‚

**æ“ä½œæ­¥éª¤**:

1. **å½•åˆ¶** (15åˆ†é’Ÿ):
   ```bash
   python record_chopping_sequence.py --output-dir logs/my_chopping --max-frames 500
   ```
   - æ¸¸æˆå¯åŠ¨åæ‰‹åŠ¨æ§åˆ¶è§’è‰²
   - å¯»æ‰¾æ ‘ â†’ é è¿‘ â†’ ç æ ‘ â†’ æ”¶é›†æœ¨å¤´
   - æŒ‰Ctrl+Cåœæ­¢

2. **éªŒè¯** (5åˆ†é’Ÿ):
   ```bash
   python verify_mineclip_16frames.py --sequence-dir logs/my_chopping
   ```

3. **å†³ç­–** (æ ¹æ®ç»“æœ):
   - å¦‚æœå˜åŒ–èŒƒå›´ > 0.05 â†’ ç«‹å³å¼€å§‹16å¸§æ¨¡å¼è®­ç»ƒ âœ…
   - å¦‚æœå˜åŒ–èŒƒå›´ < 0.05 â†’ è®¨è®ºä¸‹ä¸€æ­¥æ–¹æ¡ˆ âš ï¸

---

## ğŸ“– **ç›¸å…³æ–‡æ¡£**

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| `MINECLIP_16FRAMES_GUIDE.md` | å®Œæ•´ä½¿ç”¨æŒ‡å— |
| `UNIVERSAL_MINECLIP_STRATEGY.md` | é€šç”¨æ¡†æ¶æˆ˜ç•¥ |
| `IMPLEMENTATION_PLAN.md` | 3é˜¶æ®µå®æ–½è®¡åˆ’ |

---

## âš¡ **å¿«é€Ÿå‘½ä»¤å‚è€ƒ**

```bash
# å½•åˆ¶ç æ ‘åºåˆ—
python record_chopping_sequence.py --output-dir logs/my_chopping

# éªŒè¯16å¸§æ•ˆæœ
python verify_mineclip_16frames.py --sequence-dir logs/my_chopping

# å¿«æ·è„šæœ¬ï¼ˆäº¤äº’å¼ï¼‰
./quick_verify.sh

# è®­ç»ƒæµ‹è¯•ï¼ˆ10000æ­¥ï¼‰
./scripts/train_get_wood.sh test \
    --timesteps 10000 \
    --use-mineclip \
    --use-video-mode \
    --num-frames 16 \
    --compute-frequency 4

# TensorBoardå¯è§†åŒ–
tensorboard --logdir logs/tensorboard
```

---

## ğŸ¯ **æ ¸å¿ƒç›®æ ‡å›é¡¾**

> "æˆ‘çš„è¿œæœŸç›®æ ‡æ˜¯èƒ½å¤Ÿè‡ªå‘è®­ç»ƒä»»ä½•æŠ€èƒ½ï¼Œæ‰€ä»¥ä¸å¯èƒ½æ‰‹åŠ¨å¯¹æ‰€æœ‰çš„æŠ€èƒ½è¿›è¡Œå¯†é›†å¥–åŠ±è®¾è®¡ï¼Œæ‰€ä»¥æ‰å¼•å…¥mineclipåšå¥–åŠ±è¾…åŠ©è®¾è®¡"

**å®Œå…¨ç†è§£ï¼** è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ï¼š

1. âœ… **æ­£ç¡®å®ç°MineCLIP** - 16å¸§è§†é¢‘æ¨¡å¼ï¼Œç¬¦åˆå®˜æ–¹è®¾è®¡
2. â³ **éªŒè¯æ•ˆæœ** - å½•åˆ¶ç æ ‘åºåˆ—ï¼Œæµ‹è¯•åŒºåˆ†åº¦
3. ğŸ“‹ **å»ºç«‹é€šç”¨æ¡†æ¶** - ä»»ä½•ä»»åŠ¡åªéœ€æ”¹å˜æ–‡æœ¬æè¿°

**å¦‚æœ16å¸§MineCLIPæ•ˆæœå¥½ï¼Œä½ çš„æ¡†æ¶å°±æ˜¯**:

```python
# é€šç”¨è®­ç»ƒå‡½æ•°
def train_any_skill(task_id, task_prompt):
    env = minedojo.make(task_id)
    env = MineCLIPRewardWrapper(
        env,
        task_prompt=task_prompt,  # å”¯ä¸€éœ€è¦æ”¹çš„ï¼
        use_video_mode=True,
        num_frames=16
    )
    model.learn(...)

# è®­ç»ƒä»»ä½•æŠ€èƒ½
train_any_skill("harvest_1_log", "chopping a tree")
train_any_skill("hunt_1_cow", "killing a cow")
train_any_skill("mine_1_iron_ore", "mining iron ore")
```

**æ— éœ€æ‰‹åŠ¨è®¾è®¡å¥–åŠ±ï¼** ğŸ‰

---

## âœ… **å‡†å¤‡å¥½äº†å—ï¼Ÿ**

æ‰€æœ‰ä»£ç å·²å®Œæˆï¼Œå·¥å…·å·²å°±ç»ªï¼

**å¼€å§‹å½•åˆ¶ç æ ‘åºåˆ—å§ï¼** ğŸ¬

```bash
conda activate minedojo-x86
./quick_verify.sh
# é€‰æ‹© 2) å½•åˆ¶æ–°çš„ç æ ‘åºåˆ—
```

å½•åˆ¶å®Œæˆåï¼Œæˆ‘ä»¬ä¸€èµ·åˆ†æç»“æœï¼Œå†³å®šä¸‹ä¸€æ­¥ï¼ğŸš€


# MineCLIP è¯¾ç¨‹å­¦ä¹ ç­–ç•¥æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨MineCLIPåŠ¨æ€æƒé‡è°ƒæ•´ï¼ˆè¯¾ç¨‹å­¦ä¹ ï¼‰æ¥æå‡è®­ç»ƒæ•ˆæœã€‚

## ä»€ä¹ˆæ˜¯è¯¾ç¨‹å­¦ä¹ ï¼Ÿ

è¯¾ç¨‹å­¦ä¹ ï¼ˆCurriculum Learningï¼‰æ˜¯ä¸€ç§ä»ç®€å•åˆ°å¤æ‚çš„è®­ç»ƒç­–ç•¥ï¼Œç±»ä¼¼äºäººç±»å­¦ä¹ è¿‡ç¨‹ï¼š
- **åˆæœŸ**ï¼šé«˜MineCLIPæƒé‡ï¼Œå¼ºå¼•å¯¼ â†’ agentå­¦ä¼šåŸºæœ¬æ¢ç´¢ï¼ˆå¦‚"æ‰¾åˆ°æ ‘"ï¼‰
- **ä¸­æœŸ**ï¼šæƒé‡é€æ¸é™ä½ â†’ agentå¼€å§‹ä¾èµ–è‡ªèº«ç­–ç•¥
- **åæœŸ**ï¼šä½MineCLIPæƒé‡ â†’ agentä¸»è¦ä¾èµ–ç¨€ç–å¥–åŠ±å®Œæˆä»»åŠ¡ï¼ˆå¦‚"ç æ ‘è·å¾—æœ¨å¤´"ï¼‰

## ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€æƒé‡ï¼Ÿ

### å›ºå®šæƒé‡çš„é—®é¢˜

```python
# âŒ å›ºå®šä½æƒé‡ï¼ˆ0.1ï¼‰- æ—©æœŸæ¢ç´¢å›°éš¾
mineclip_weight = 0.1  # agentä¸çŸ¥é“å»å“ªé‡Œæ‰¾æ ‘

# âŒ å›ºå®šé«˜æƒé‡ï¼ˆ1.0ï¼‰- åæœŸä¾èµ–è¿‡åº¦
mineclip_weight = 1.0  # agentåªä¼š"çœ‹æ ‘"ï¼Œä¸ä¼šå®Œæˆä»»åŠ¡
```

### åŠ¨æ€æƒé‡çš„ä¼˜åŠ¿

```python
# âœ… åŠ¨æ€è°ƒæ•´
åˆå§‹: mineclip_weight = 1.0   # å¼ºå¼•å¯¼ï¼Œå¸®åŠ©æ¢ç´¢
â†“
ä¸­æœŸ: mineclip_weight = 0.5   # é€æ¸ç‹¬ç«‹
â†“
æœ€ç»ˆ: mineclip_weight = 0.01  # ä¸»è¦é ç¨€ç–å¥–åŠ±
```

## æƒé‡è¡°å‡ç­–ç•¥

å½“å‰å®ç°ä½¿ç”¨**ä½™å¼¦è¡°å‡**ï¼š

```
æƒé‡
  â†‘
1.0 |â€¾â€¾â€¾â•²
    |     â•²
0.5 |      â•²___
    |           â•²___
0.01|________________â•²_____
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ­¥æ•°
    0     25k    50k    75k
```

æ•°å­¦å…¬å¼ï¼š
```python
progress = min(step / decay_steps, 1.0)
decay_factor = 0.5 * (1.0 + cos(Ï€ * progress))
weight = min_weight + (initial_weight - min_weight) * decay_factor
```

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: è®­ç»ƒè„šæœ¬å‚æ•°ï¼ˆæ¨èï¼‰

```bash
python src/training/train_get_wood.py \
    --use-mineclip \
    --sparse-weight 10.0 \           # ç¨€ç–å¥–åŠ±æƒé‡ï¼ˆå›ºå®šï¼‰
    --mineclip-weight 10.0 \         # MineCLIPåˆå§‹æƒé‡ï¼ˆä¸ç¨€ç–æƒé‡ç›¸åŒï¼‰
    --use-dynamic-weight \           # å¯ç”¨åŠ¨æ€è°ƒæ•´
    --weight-decay-steps 50000 \     # è¡°å‡æ­¥æ•°
    --min-weight 0.1                 # æœ€å°æƒé‡
```

### æ–¹æ³•2: ä½¿ç”¨Shellè„šæœ¬

ç¼–è¾‘ `scripts/train_get_wood.sh`ï¼Œå·²ç»é…ç½®å¥½é»˜è®¤å‚æ•°ï¼š

```bash
./scripts/train_get_wood.sh mineclip
```

### æ–¹æ³•3: ç¦ç”¨åŠ¨æ€æƒé‡ï¼ˆä½¿ç”¨å›ºå®šæƒé‡ï¼‰

```bash
python src/training/train_get_wood.py \
    --use-mineclip \
    --mineclip-weight 0.1 \
    --no-dynamic-weight              # ç¦ç”¨ï¼Œä½¿ç”¨å›ºå®šæƒé‡0.1
```

## å‚æ•°è°ƒä¼˜æŒ‡å—

### 1. åˆå§‹æƒé‡ `--mineclip-weight`

| å€¼ | ä¸sparse_weightæ¯”ä¾‹ | é€‚ç”¨åœºæ™¯ | è¯´æ˜ |
|----|-------------------|---------|------|
| 5.0 | 1:2 | ç®€å•ä»»åŠ¡ | MineCLIPè¾…åŠ©å¼•å¯¼ |
| **10.0** | **1:1ï¼ˆæ¨èï¼‰** | **ä¸­ç­‰ä»»åŠ¡** | **MineCLIPä¸ç¨€ç–å¥–åŠ±åŒç­‰é‡è¦** |
| 20.0 | 2:1 | å›°éš¾ä»»åŠ¡ | MineCLIPä¸»å¯¼ï¼Œå¼ºå¼•å¯¼ |

**åŸåˆ™**ï¼šåˆå§‹é˜¶æ®µMineCLIPåº”è¯¥æœ‰è¶³å¤Ÿçš„æƒé‡æ¥å¼•å¯¼agentæ¢ç´¢

### 2. è¡°å‡æ­¥æ•° `--weight-decay-steps`

| å€¼ | æ€»è®­ç»ƒæ­¥æ•° | è¯´æ˜ |
|----|-----------|------|
| 30000 | 100k | å¿«é€Ÿé™ä½æƒé‡ |
| **50000** | **200kï¼ˆæ¨èï¼‰** | **å¹³è¡¡è¡°å‡** |
| 100000 | 500k | ç¼“æ…¢è¡°å‡ |

**ç»éªŒå…¬å¼**ï¼š`decay_steps = total_steps * 0.25`

### 3. æœ€å°æƒé‡ `--min-weight`

| å€¼ | ä¸åˆå§‹æƒé‡æ¯”ä¾‹ | è¯´æ˜ |
|----|--------------|------|
| 0.01 | 0.1% | å‡ ä¹å®Œå…¨ç§»é™¤MineCLIP |
| **0.1ï¼ˆæ¨èï¼‰** | **1%** | **ä¿æŒå¾®å¼±å¼•å¯¼ä¿¡å·** |
| 1.0 | 10% | ä¿æŒè¾ƒå¼ºå¼•å¯¼ |

**åŸåˆ™**ï¼šæœ€å°æƒé‡åº”è¯¥æ˜¯åˆå§‹æƒé‡çš„1%-10%ï¼Œè®©agentåœ¨åæœŸä¸»è¦ä¾èµ–ç¨€ç–å¥–åŠ±

### 4. ç¨€ç–æƒé‡ `--sparse-weight`

| å€¼ | è¯´æ˜ |
|----|------|
| 5.0 | MineCLIPä¸»å¯¼ |
| **10.0ï¼ˆæ¨èï¼‰** | å¹³è¡¡ |
| 20.0 | ç¨€ç–å¥–åŠ±ä¸»å¯¼ |

## å®æ—¶ç›‘æ§

### è®­ç»ƒæ—¥å¿—æ˜¾ç¤º

æ–°çš„å®æ—¶æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š

```
==================================================================================================================================
ğŸš€ å¼€å§‹è®­ç»ƒ...
==================================================================================================================================
  å›åˆæ•° |       æ­¥æ•° |     æ€»æ—¶é—´ |      FPS |     æ€»å¥–åŠ± |   MineCLIP |  MCæƒé‡ |   æƒé‡æ¯” |   ç›¸ä¼¼åº¦ |       æŸå¤±
----------------------------------------------------------------------------------------------------------------------------------
       5 |        500 | 00:02:15 |    220.5 |     0.0234 |     0.0123 |  10.0000 |     1.00 |   0.5234 |     0.0456
      12 |      1,200 | 00:05:23 |    245.6 |     0.1234 |     0.0567 |   9.5000 |     1.05 |   0.6123 |     0.0389
      25 |      2,500 | 00:11:05 |    248.2 |     0.2567 |     0.0892 |   8.2000 |     1.22 |   0.6789 |     0.0312
     150 |     50,000 | 03:20:15 |    250.1 |     2.5678 |     0.3456 |   0.1000 |   100.00 |   0.8456 |     0.0156
```

å…³é”®æŒ‡æ ‡ï¼š
- **MineCLIP**ï¼šæœªåŠ æƒçš„MineCLIPå¥–åŠ±ï¼ˆåŸå§‹ç›¸ä¼¼åº¦è¿›æ­¥ï¼‰
- **MCæƒé‡**ï¼šå½“å‰MineCLIPæƒé‡ï¼ˆåŠ¨æ€å˜åŒ–ï¼Œä»10.0â†’0.1ï¼‰
- **æƒé‡æ¯”**ï¼šsparse_weight / mineclip_weightï¼ˆä»1.0â†’100.0ï¼‰
- **ç›¸ä¼¼åº¦**ï¼šä¸ä»»åŠ¡ç›®æ ‡çš„ç›¸ä¼¼åº¦ï¼ˆ0-1ï¼‰

**æƒé‡æ¯”è§£è¯»**ï¼š
- æ¯”ä¾‹ 1:1ï¼ˆæƒé‡æ¯”=1.0ï¼‰â†’ åˆæœŸï¼ŒMineCLIPå’Œç¨€ç–å¥–åŠ±åŒç­‰é‡è¦
- æ¯”ä¾‹ 10:1ï¼ˆæƒé‡æ¯”=10.0ï¼‰â†’ ä¸­æœŸï¼Œé€æ¸ä¾§é‡ç¨€ç–å¥–åŠ±
- æ¯”ä¾‹ 100:1ï¼ˆæƒé‡æ¯”=100.0ï¼‰â†’ åæœŸï¼Œä¸»è¦ä¾èµ–ç¨€ç–å¥–åŠ±

### TensorBoardæŸ¥çœ‹

TensorBoardä¼šè‡ªåŠ¨è®°å½•ï¼ˆå¦‚æœMineCLIPåŒ…è£…å™¨å®ç°äº†è®°å½•ï¼‰ï¼š
- `reward/mineclip_weight`: æƒé‡å˜åŒ–æ›²çº¿
- `reward/mineclip_raw`: åŸå§‹MineCLIPå¥–åŠ±
- `reward/similarity`: ç›¸ä¼¼åº¦æ›²çº¿

## å…¸å‹è®­ç»ƒæ›²çº¿

### å¥åº·çš„è®­ç»ƒè¿‡ç¨‹

```
å¥–åŠ±
  â†‘
  |           ï¼ï¿£ï¿£ï¿£
  |         ï¼
  |      ï¼ 
  |   ï¼
  |ï¼___________________â†’ æ­¥æ•°
  0    50k   100k  150k

ç›¸ä¼¼åº¦
  â†‘
  |    ï¼ï¿£ï¿£ï¿£ï¿£
  |  ï¼
  |ï¼___________________â†’ æ­¥æ•°
  0    50k   100k  150k

æƒé‡
  â†‘
1.0|â€¾â€¾â€¾â•²
  |     â•²___
0.01|_________â•²_________â†’ æ­¥æ•°
  0    50k   100k  150k
```

**è¯´æ˜**ï¼š
1. ç›¸ä¼¼åº¦å¿«é€Ÿä¸Šå‡ï¼ˆæ‰¾åˆ°ç›®æ ‡ï¼‰
2. æƒé‡é€æ¸ä¸‹é™
3. å¥–åŠ±æŒç»­å¢é•¿ï¼ˆå®Œæˆä»»åŠ¡ï¼‰

### éœ€è¦è°ƒæ•´çš„æƒ…å†µ

#### é—®é¢˜1: ç›¸ä¼¼åº¦ä¸å¢é•¿

```
ç›¸ä¼¼åº¦
  â†‘
  |ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿
  |___________________â†’ æ­¥æ•°
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¢åŠ åˆå§‹æƒé‡ï¼š`--mineclip-weight 2.0`
- å»¶é•¿è¡°å‡æ­¥æ•°ï¼š`--weight-decay-steps 100000`

#### é—®é¢˜2: å¥–åŠ±åœ¨åæœŸä¸å¢é•¿

```
å¥–åŠ±
  â†‘
  |  ï¼ï¿£ï¿£ï¿£ï¿£ï¿£
  |ï¼___________________â†’ æ­¥æ•°
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é™ä½æœ€å°æƒé‡ï¼š`--min-weight 0.0`
- å¢åŠ ç¨€ç–æƒé‡ï¼š`--sparse-weight 20.0`

## æ— å¤´æ¨¡å¼æ§åˆ¶

### å¯ç”¨æ— å¤´æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œæ¨èç”¨äºè®­ç»ƒï¼‰

```bash
python src/training/train_get_wood.py --headless
```

### ç¦ç”¨æ— å¤´æ¨¡å¼ï¼ˆç”¨äºè°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°æ¸¸æˆç”»é¢ï¼‰

```bash
python src/training/train_get_wood.py --no-headless
```

**æ³¨æ„**ï¼š
- æ— å¤´æ¨¡å¼å¯ä»¥æå‡è®­ç»ƒé€Ÿåº¦ï¼ˆæ— æ¸²æŸ“å¼€é”€ï¼‰
- è°ƒè¯•æ—¶ä½¿ç”¨æœ‰å¤´æ¨¡å¼å¯ä»¥è§‚å¯Ÿagentè¡Œä¸º
- macOSå¯èƒ½éœ€è¦é¢å¤–é…ç½®æ‰èƒ½ä½¿ç”¨æ— å¤´æ¨¡å¼

## å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1: æ ‡å‡†è®­ç»ƒï¼ˆ200kæ­¥ï¼‰

```bash
python src/training/train_get_wood.py \
    --total-timesteps 200000 \
    --use-mineclip \
    --mineclip-model data/mineclip/attn.pth \
    --sparse-weight 10.0 \
    --mineclip-weight 10.0 \      # åˆå§‹1:1æ¯”ä¾‹
    --use-dynamic-weight \
    --weight-decay-steps 50000 \
    --min-weight 0.1 \            # æœ€ç»ˆ100:1æ¯”ä¾‹
    --headless \
    --device auto
```

### ç¤ºä¾‹2: å¿«é€Ÿæµ‹è¯•ï¼ˆ10kæ­¥ï¼‰

```bash
python src/training/train_get_wood.py \
    --total-timesteps 10000 \
    --use-mineclip \
    --mineclip-weight 10.0 \
    --use-dynamic-weight \
    --weight-decay-steps 5000 \
    --min-weight 0.1 \
    --headless
```

### ç¤ºä¾‹3: å›°éš¾ä»»åŠ¡ï¼ˆéœ€è¦æ›´å¼ºå¼•å¯¼ï¼‰

```bash
python src/training/train_get_wood.py \
    --total-timesteps 500000 \
    --use-mineclip \
    --sparse-weight 10.0 \
    --mineclip-weight 20.0 \       # åˆå§‹2:1æ¯”ä¾‹ï¼ŒMineCLIPä¸»å¯¼
    --weight-decay-steps 100000 \   # æ›´é•¿è¡°å‡æœŸ
    --min-weight 0.2 \              # æœ€ç»ˆ50:1æ¯”ä¾‹
    --headless
```

## è°ƒè¯•æŠ€å·§

### 1. è§‚å¯Ÿæƒé‡å˜åŒ–

æŸ¥çœ‹æ—¥å¿—ä¸­çš„"æƒé‡"åˆ—ï¼Œåº”è¯¥çœ‹åˆ°å¹³æ»‘ä¸‹é™ã€‚

### 2. å¯¹æ¯”å›ºå®švsåŠ¨æ€

```bash
# è¿è¡Œ1: å›ºå®šæƒé‡
python src/training/train_get_wood.py \
    --use-mineclip --mineclip-weight 0.1 --no-dynamic-weight \
    --tensorboard-dir logs/tensorboard/fixed

# è¿è¡Œ2: åŠ¨æ€æƒé‡
python src/training/train_get_wood.py \
    --use-mineclip --mineclip-weight 1.0 --use-dynamic-weight \
    --tensorboard-dir logs/tensorboard/dynamic
```

åœ¨TensorBoardä¸­å¯¹æ¯”ä¸¤æ¡æ›²çº¿ã€‚

### 3. æ£€æŸ¥ç›¸ä¼¼åº¦

å¦‚æœç›¸ä¼¼åº¦å§‹ç»ˆå¾ˆä½ï¼ˆ<0.3ï¼‰ï¼Œå¯èƒ½ï¼š
- MineCLIPæ¨¡å‹æœªæ­£ç¡®åŠ è½½
- ä»»åŠ¡æè¿°ä¸åŒ¹é…
- å›¾åƒé¢„å¤„ç†æœ‰é—®é¢˜

## å¸¸è§é—®é¢˜

**Q: ä»€ä¹ˆæ—¶å€™ä¸éœ€è¦åŠ¨æ€æƒé‡ï¼Ÿ**
A: 
- ä»»åŠ¡éå¸¸ç®€å•ï¼ˆå‡ åƒæ­¥å°±èƒ½å®Œæˆï¼‰
- å·²ç»æ‰¾åˆ°äº†æœ€ä¼˜çš„å›ºå®šæƒé‡
- çº¯æ¢ç´¢ä»»åŠ¡ï¼ˆæ— æ˜ç¡®ç¨€ç–å¥–åŠ±ï¼‰

**Q: æƒé‡é™åˆ°æœ€å°å€¼åä¼šç»§ç»­å˜åŒ–å—ï¼Ÿ**
A: ä¸ä¼šï¼Œè¾¾åˆ°`min_weight`åä¼šä¿æŒä¸å˜ã€‚

**Q: å¯ä»¥åœ¨è®­ç»ƒä¸­é€”æ”¹å˜æƒé‡ç­–ç•¥å—ï¼Ÿ**
A: å¯ä»¥ï¼Œé€šè¿‡åŠ è½½æ£€æŸ¥ç‚¹å¹¶ä¿®æ”¹å‚æ•°ç»§ç»­è®­ç»ƒï¼š
```bash
# ç¬¬ä¸€é˜¶æ®µï¼šé«˜æƒé‡æ¢ç´¢
python train_get_wood.py --mineclip-weight 2.0 --total-timesteps 50000

# ç¬¬äºŒé˜¶æ®µï¼šä»æ£€æŸ¥ç‚¹ç»§ç»­ï¼Œé™ä½æƒé‡
python train_get_wood.py --load-checkpoint xxx.zip --mineclip-weight 0.1
```

**Q: å¦‚ä½•çŸ¥é“æƒé‡è¡°å‡æ˜¯å¦å¤ªå¿«/å¤ªæ…¢ï¼Ÿ**
A: è§‚å¯Ÿå¥–åŠ±æ›²çº¿ï¼š
- å¤ªå¿«ï¼šå¥–åŠ±åœ¨ä¸­æœŸåœæ­¢å¢é•¿
- å¤ªæ…¢ï¼šåæœŸä»ç„¶é«˜åº¦ä¾èµ–MineCLIP
- åˆé€‚ï¼šå¥–åŠ±æŒç»­å¹³ç¨³å¢é•¿

## æ€»ç»“

âœ… **æ¨èé»˜è®¤é…ç½®**ï¼š
```bash
--sparse-weight 10.0         # ç¨€ç–å¥–åŠ±æƒé‡
--mineclip-weight 10.0       # åˆå§‹æƒé‡ä¸ç¨€ç–æƒé‡ç›¸åŒï¼ˆæ¯”ä¾‹1:1ï¼‰
--use-dynamic-weight         # å¯ç”¨åŠ¨æ€è°ƒæ•´
--weight-decay-steps 50000   # ä¸ºæ€»æ­¥æ•°çš„25%
--min-weight 0.1             # æœ€ç»ˆé™åˆ°åˆå§‹å€¼çš„1%ï¼ˆ10.0â†’0.1ï¼‰
--headless                   # æ— å¤´æ¨¡å¼
```

**æƒé‡è®¾ç½®åŸåˆ™**ï¼š
- **åˆæœŸæ¯”ä¾‹ 1:1**ï¼ˆsparse:mineclip = 10:10ï¼‰â†’ MineCLIPå’Œç¨€ç–å¥–åŠ±åŒç­‰é‡è¦
- **æœ€ç»ˆæ¯”ä¾‹ 100:1**ï¼ˆsparse:mineclip = 10:0.1ï¼‰â†’ ä¸»è¦ä¾èµ–ç¨€ç–å¥–åŠ±

è¿™ä¸ªé…ç½®é€‚ç”¨äºå¤§å¤šæ•°MineDojoä»»åŠ¡ã€‚æ ¹æ®å…·ä½“ä»»åŠ¡è¡¨ç°å¾®è°ƒå‚æ•°ã€‚

## ç›¸å…³æ–‡æ¡£

- [MineCLIPå¥–åŠ±è¯¦è§£](MINECLIP_REWARD_EXPLAINED.md)
- [MineCLIPè®¾ç½®æŒ‡å—](MINECLIP_SETUP_GUIDE.md)
- [TensorBoardä¸­æ–‡æŒ‡å—](TENSORBOARD_ä¸­æ–‡æŒ‡å—.md)


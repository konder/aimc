# State Labeling - 键盘控制参考

> **快速参考**: `tools/label_states.py` 交互式标注的键盘映射

---

## 📋 **基础控制**

### **移动控制**
| 键位 | 动作 | 动作数组 |
|------|------|---------|
| `W` | 前进 | `[1, 0, 0, 12, 12, 0, 0, 0]` |
| `S` | 后退 | `[2, 0, 0, 12, 12, 0, 0, 0]` |
| `A` | 左移 | `[0, 1, 0, 12, 12, 0, 0, 0]` |
| `D` | 右移 | `[0, 2, 0, 12, 12, 0, 0, 0]` |

### **视角控制**
| 键位 | 动作 | 动作数组 |
|------|------|---------|
| `I` | 向上看 | `[0, 0, 0, 8, 12, 0, 0, 0]` |
| `K` | 向下看 | `[0, 0, 0, 16, 12, 0, 0, 0]` |
| `J` | 向左看 | `[0, 0, 0, 12, 8, 0, 0, 0]` |
| `L` | 向右看 | `[0, 0, 0, 12, 16, 0, 0, 0]` |

### **基础动作**
| 键位 | 动作 | 动作数组 |
|------|------|---------|
| `F` | 攻击（砍树）| `[0, 0, 0, 12, 12, 3, 0, 0]` |
| `Space` | 跳跃 | `[0, 0, 1, 12, 12, 0, 0, 0]` |

---

## 🎯 **组合动作**

### **移动+攻击**
| 键位 | 动作 | 动作数组 | 使用场景 |
|------|------|---------|---------|
| `Q` | 前进+攻击 | `[1, 0, 0, 12, 12, 3, 0, 0]` | 边走边砍树 |
| `E` | 向上看+攻击 | `[0, 0, 0, 8, 12, 3, 0, 0]` | 砍高处的树叶 |

### **移动+跳跃** ✨ NEW
| 键位 | 动作 | 动作数组 | 使用场景 |
|------|------|---------|---------|
| `R` | 前进+跳跃 | `[1, 0, 1, 12, 12, 0, 0, 0]` | 跳过障碍物 |
| `T` | 后退+跳跃 | `[2, 0, 1, 12, 12, 0, 0, 0]` | 后退避让 |

### **全套组合** ✨ NEW
| 键位 | 动作 | 动作数组 | 使用场景 |
|------|------|---------|---------|
| `G` | 前进+跳跃+攻击 | `[1, 0, 1, 12, 12, 3, 0, 0]` | 跳起砍树 |

---

## ⚙️ **特殊控制**

| 键位 | 功能 | 说明 |
|------|------|------|
| `N` | 跳过此状态 | 不标注当前状态，直接进入下一个 |
| `Z` | 撤销上一个标注 | 回退到上一个状态，重新标注（最多10步）|
| `X` | 完成标注 | 保存当前所有标注并退出 |
| `ESC` | 完成标注 | 同 `X` |

---

## 💡 **使用技巧**

### **1. 高效标注策略**

#### **失败场景分析**
当智能体失败时，通常是因为：
- ❌ **没看到树**: 应该标注 `I` (向上看) 或 `J`/`L` (左右转)
- ❌ **没靠近树**: 应该标注 `W` (前进) 或 `Q` (前进+攻击)
- ❌ **没攻击**: 应该标注 `F` (攻击) 或 `Q` (前进+攻击)
- ❌ **跳跃不当**: 应该标注 `R` (前进+跳跃) 或 `Space` (跳跃)

#### **最常用的5个键**
1. **`Q`** (前进+攻击) - 最常用，边走边砍
2. **`I`** (向上看) - 寻找树木
3. **`W`** (前进) - 靠近树木
4. **`R`** (前进+跳跃) - 跨越障碍
5. **`N`** (跳过) - 不确定的状态直接跳过

### **2. 标注优先级**

| 优先级 | 场景 | 标注策略 |
|--------|------|---------|
| 🔴 **HIGH** | 失败前5-10步 | 100%标注，这些是关键决策 |
| 🟡 **MEDIUM** | 成功episode中段 | 跳过（按`N`），节省时间 |
| 🟢 **LOW** | 成功episode开头 | 跳过（按`N`），节省时间 |

### **3. 快速标注流程**

```
看到画面 → 判断策略错误 → 按对应快捷键 → 下一个
  ↓
如果不确定 → 按 'N' 跳过 → 下一个
  ↓
如果标错了 → 按 'Z' 撤销 → 重新标注
```

---

## 📊 **典型标注场景**

### **场景1: 智能体向下看地面**
```
Policy Action: [0, 0, 0, 16, 12, 0, 0, 0]
>>> Look Down

你应该标注: I (向上看寻找树)
```

### **场景2: 智能体原地不动**
```
Policy Action: [0, 0, 0, 12, 12, 0, 0, 0]
>>> Idle

你应该标注: W (前进) 或 Q (前进+攻击)
```

### **场景3: 智能体只前进不攻击**
```
Policy Action: [1, 0, 0, 12, 12, 0, 0, 0]
>>> Forward

你应该标注: Q (前进+攻击)
```

### **场景4: 智能体遇到障碍物**
```
Policy Action: [1, 0, 0, 12, 12, 0, 0, 0]
>>> Forward

你应该标注: R (前进+跳跃)
```

### **场景5: 智能体需要跳起砍树**
```
Policy Action: [1, 0, 0, 12, 12, 3, 0, 0]
>>> Forward + Attack

你应该标注: G (前进+跳跃+攻击)
```

---

## 🎮 **完整键盘布局**

```
        [I] 上看
         |
    [J]--+--[L]  (左看/右看)
         |
        [K] 下看

[W]       [E] 上看+攻击    [R] 前进+跳跃    [T] 后退+跳跃
 |                                          
[A][S][D]  [Q] 前进+攻击    [G] 前进+跳跃+攻击
(左前右)
         [F] 攻击          [Space] 跳跃

特殊: [N] 跳过  [Z] 撤销  [X/ESC] 完成
```

---

## 📈 **预期标注效率**

| 状态数 | 智能采样 | 预计时间 | 实际标注数 |
|--------|---------|---------|-----------|
| 5000 | ✅ 开启 | 30-40分钟 | ~800-1000 |
| 5000 | ❌ 关闭 | 2-3小时 | ~5000 |
| 10000 | ✅ 开启 | 50-60分钟 | ~1500-2000 |

**智能采样效率提升**: 80%+ 时间节省 ✅

---

## ⚠️ **常见问题**

### **Q: 为什么要标注"前进+跳跃"？**
**A**: 在Minecraft中，跳跃可以：
- 跨越小障碍物（草丛、矮墙）
- 加速移动（跳跃冲刺）
- 到达高处（跳上树根）

DAgger学习过程中，这些场景经常出现，需要正确标注。

### **Q: 组合键太多记不住怎么办？**
**A**: 只需记住最常用的5个：
1. `Q` - 前进+攻击
2. `I` - 向上看
3. `R` - 前进+跳跃
4. `N` - 跳过
5. `Z` - 撤销

### **Q: 什么时候用 'G' (前进+跳跃+攻击)？**
**A**: 很少用，主要场景：
- 树木在小山丘上，需要跳起砍
- 树根很高，需要跳起靠近
- 建议：不确定时按 `N` 跳过

---

## 📚 **相关文档**

- [`DAGGER_QUICK_START.md`](../guides/DAGGER_QUICK_START.md) - DAgger完整流程
- [`KEYBOARD_REFERENCE_CARD.md`](../guides/KEYBOARD_REFERENCE_CARD.md) - 录制脚本键盘参考
- [`DAGGER_DETAILED_GUIDE.md`](../guides/DAGGER_DETAILED_GUIDE.md) - DAgger算法详解

---

**祝标注顺利！** 🚀

记住：不确定的状态直接按 `N` 跳过，不影响训练效果。


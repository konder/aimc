# MineDojo 完整动作空间参考

> **目的**: 为录制和训练提供完整的MineDojo动作空间参考

---

## 📊 **MineDojo Action Space 完整定义**

```python
MultiDiscrete([3, 3, 4, 25, 25, 8, 244, 36])
```

---

## 🎯 **8维动作详解**

### **维度0: forward_back (前后移动)**
```
范围: 0-2 (共3个选项)
├─ 0: 停止
├─ 1: 前进 (W键)
└─ 2: 后退 (S键)
```

---

### **维度1: left_right (左右移动)**
```
范围: 0-2 (共3个选项)
├─ 0: 停止
├─ 1: 左移 (A键)
└─ 2: 右移 (D键)
```

**组合移动**:
- `[1, 0, ...]` - 前进
- `[2, 0, ...]` - 后退
- `[0, 1, ...]` - 左移
- `[0, 2, ...]` - 右移
- `[1, 1, ...]` - 前进+左移（斜向移动）
- `[1, 2, ...]` - 前进+右移（斜向移动）

---

### **维度2: jump (跳跃)**
```
范围: 0-3 (共4个选项)
├─ 0: 不跳跃
├─ 1: 跳跃 (Space键)
├─ 2: ❓ (未知，可能是下蹲?)
└─ 3: ❓ (未知，可能是疾跑跳跃?)
```

**常用组合**:
- `[1, 0, 1, ...]` - 跳跃前进
- `[1, 0, 0, ...]` - 普通前进

---

### **维度3: pitch (相机俯仰角 - 上下看)**
```
范围: 0-24 (共25个选项)
├─ 0-11: 向上看 (数值越小越向上)
├─ 12: 水平视角 (中心位置) ⭐ 默认
└─ 13-24: 向下看 (数值越大越向下)
```

**常用值**:
- `8` - 向上看 (I键, -4单位)
- `10` - 微向上看 (-2单位)
- `12` - 水平视角 (中心)
- `14` - 微向下看 (+2单位)
- `16` - 向下看 (K键, +4单位)

**角度计算**:
- 每单位约 ≈ 15度
- `pitch=8` ≈ 向上60度
- `pitch=16` ≈ 向下60度

---

### **维度4: yaw (相机偏航角 - 左右看)**
```
范围: 0-24 (共25个选项)
├─ 0-11: 向左转 (数值越小越向左)
├─ 12: 正前方 (中心位置) ⭐ 默认
└─ 13-24: 向右转 (数值越大越向右)
```

**常用值**:
- `8` - 向左看 (J键, -4单位)
- `10` - 微向左看 (-2单位)
- `12` - 正前方 (中心)
- `14` - 微向右看 (+2单位)
- `16` - 向右看 (L键, +4单位)

**角度计算**:
- 每单位约 ≈ 15度
- `yaw=8` ≈ 左转60度
- `yaw=16` ≈ 右转60度

---

### **维度5: functional (功能动作)** ⭐ **重要**
```
范围: 0-7 (共8个选项)
├─ 0: 无动作 (默认)
├─ 1: ❓ (使用物品? / 放置方块?)
├─ 2: ❓ (交互? / 拾取?)
├─ 3: 攻击/挖掘 ✅ (F键 - 已验证有效)
├─ 4: ❓ (潜行?)
├─ 5: ❓ (丢弃物品?)
├─ 6: ❓ (切换物品栏?)
└─ 7: ❓ (其他?)
```

**已确认**:
- `functional=3` → **攻击/砍树/挖方块** ✅

**待验证**:
- `functional=1` 可能是"使用物品"或"放置方块"
- `functional=2` 可能是"交互"（打开箱子、与NPC对话等）
- 其他值需要测试确认

---

### **维度6: craft (合成)**
```
范围: 0-243 (共244个合成配方)
├─ 0: 无合成
└─ 1-243: 各种物品的合成配方ID
```

**砍树任务**: 通常不需要，保持为0

**常见合成** (需要查MineDojo文档确认ID):
- 木棍 (stick)
- 木板 (planks)
- 工作台 (crafting_table)
- 等等...

---

### **维度7: smelt (熔炼)**
```
范围: 0-35 (共36个熔炼配方)
├─ 0: 无熔炼
└─ 1-35: 各种熔炼配方ID
```

**砍树任务**: 不需要，保持为0

---

## 🎮 **推荐按键映射方案**

### **方案A: WASD移动 + IJKL视角** (当前使用) ✅

```python
# 移动控制
'w' → [1, 0, 0, 12, 12, 0, 0, 0]  # 前进
's' → [2, 0, 0, 12, 12, 0, 0, 0]  # 后退
'a' → [0, 1, 0, 12, 12, 0, 0, 0]  # 左移
'd' → [0, 2, 0, 12, 12, 0, 0, 0]  # 右移

# 视角控制
'i' → [0, 0, 0, 8, 12, 0, 0, 0]   # 向上看
'k' → [0, 0, 0, 16, 12, 0, 0, 0]  # 向下看
'j' → [0, 0, 0, 12, 8, 0, 0, 0]   # 向左看
'l' → [0, 0, 0, 12, 16, 0, 0, 0]  # 向右看

# 功能动作
'f' → [0, 0, 0, 12, 12, 3, 0, 0]  # 攻击/砍树
' ' (空格) → [0, 0, 0, 12, 12, 0, 0, 0] + jump=1  # 跳跃

# 组合动作
'q' → [1, 0, 0, 12, 12, 3, 0, 0]  # 前进+攻击
'e' → [0, 0, 0, 8, 12, 3, 0, 0]   # 向上看+攻击
```

**优点**:
- ✅ 符合传统FPS游戏习惯
- ✅ 左手WASD移动，右手IJKL视角，F攻击
- ✅ 避免冲突

**缺点**:
- ⚠️ IJKL不如方向键直观
- ⚠️ 右手需要在键盘右侧

---

### **方案B: WASD移动 + 小键盘视角** (备选)

```python
# 移动控制
'w' → [1, 0, 0, 12, 12, 0, 0, 0]  # 前进
's' → [2, 0, 0, 12, 12, 0, 0, 0]  # 后退
'a' → [0, 1, 0, 12, 12, 0, 0, 0]  # 左移
'd' → [0, 2, 0, 12, 12, 0, 0, 0]  # 右移

# 视角控制（小键盘）
'8' (NumPad) → [0, 0, 0, 8, 12, 0, 0, 0]   # 向上看
'2' (NumPad) → [0, 0, 0, 16, 12, 0, 0, 0]  # 向下看
'4' (NumPad) → [0, 0, 0, 12, 8, 0, 0, 0]   # 向左看
'6' (NumPad) → [0, 0, 0, 12, 16, 0, 0, 0]  # 向右看

# 功能动作
'f' → [0, 0, 0, 12, 12, 3, 0, 0]  # 攻击/砍树
' ' (空格) → [0, 0, 0, 12, 12, 0, 0, 0] + jump=1  # 跳跃
```

**优点**:
- ✅ 小键盘方向键更直观（8=上，2=下，4=左，6=右）
- ✅ 右手可以放在鼠标上（如果需要）

**缺点**:
- ⚠️ 需要有小键盘的键盘
- ⚠️ macOS笔记本通常没有小键盘

---

### **方案C: 鼠标视角控制** (最复杂，未实现)

```python
# 移动控制
'w' → [1, 0, 0, ?, ?, 0, 0, 0]  # 前进
's' → [2, 0, 0, ?, ?, 0, 0, 0]  # 后退
'a' → [0, 1, 0, ?, ?, 0, 0, 0]  # 左移
'd' → [0, 2, 0, ?, ?, 0, 0, 0]  # 右移

# 视角控制（鼠标）
鼠标移动 → 动态计算 pitch, yaw

# 功能动作
鼠标左键 → [0, 0, 0, ?, ?, 3, 0, 0]  # 攻击
鼠标右键 → [0, 0, 0, ?, ?, 1, 0, 0]  # 使用/放置?
```

**优点**:
- ✅ 最接近真实Minecraft体验
- ✅ 视角控制精准

**缺点**:
- ❌ 实现复杂（需要处理鼠标事件）
- ❌ pitch/yaw需要连续值映射到离散值
- ❌ OpenCV窗口鼠标控制不够流畅

**建议**: 暂不实现，保持方案A

---

## 📝 **常用动作组合示例**

### **基础移动**

```python
# 停止/静止
[0, 0, 0, 12, 12, 0, 0, 0]

# 前进
[1, 0, 0, 12, 12, 0, 0, 0]

# 后退
[2, 0, 0, 12, 12, 0, 0, 0]

# 左移
[0, 1, 0, 12, 12, 0, 0, 0]

# 右移
[0, 2, 0, 12, 12, 0, 0, 0]

# 前进+左移（斜向）
[1, 1, 0, 12, 12, 0, 0, 0]

# 前进+右移（斜向）
[1, 2, 0, 12, 12, 0, 0, 0]
```

---

### **视角控制**

```python
# 向上看（寻找树木）
[0, 0, 0, 8, 12, 0, 0, 0]

# 向下看（看地面/树根）
[0, 0, 0, 16, 12, 0, 0, 0]

# 向左看
[0, 0, 0, 12, 8, 0, 0, 0]

# 向右看
[0, 0, 0, 12, 16, 0, 0, 0]

# 向上+向左看（左上角）
[0, 0, 0, 8, 8, 0, 0, 0]

# 向下+向右看（右下角）
[0, 0, 0, 16, 16, 0, 0, 0]
```

---

### **跳跃和攀爬**

```python
# 原地跳跃
[0, 0, 1, 12, 12, 0, 0, 0]

# 前进跳跃（跳过障碍）
[1, 0, 1, 12, 12, 0, 0, 0]

# 后退跳跃
[2, 0, 1, 12, 12, 0, 0, 0]
```

---

### **砍树动作**

```python
# 静止攻击（已对准树木）
[0, 0, 0, 12, 12, 3, 0, 0]

# 前进+攻击（靠近并砍树）
[1, 0, 0, 12, 12, 3, 0, 0]

# 向上看+攻击（砍高处树叶）
[0, 0, 0, 8, 12, 3, 0, 0]

# 向下看+攻击（砍树根）
[0, 0, 0, 16, 12, 3, 0, 0]

# 左移+攻击（绕树砍）
[0, 1, 0, 12, 12, 3, 0, 0]
```

---

## 🔧 **自定义按键映射模板**

如果你想使用其他按键，可以参考以下模板：

```python
class KeyboardController:
    def __init__(self):
        self.action_mapping = {
            # 移动控制 - 自定义你的按键
            'YOUR_FORWARD_KEY': [1, 0, 0, 12, 12, 0, 0, 0],
            'YOUR_BACK_KEY': [2, 0, 0, 12, 12, 0, 0, 0],
            'YOUR_LEFT_KEY': [0, 1, 0, 12, 12, 0, 0, 0],
            'YOUR_RIGHT_KEY': [0, 2, 0, 12, 12, 0, 0, 0],
            
            # 视角控制 - 自定义你的按键
            'YOUR_LOOK_UP_KEY': [0, 0, 0, 8, 12, 0, 0, 0],
            'YOUR_LOOK_DOWN_KEY': [0, 0, 0, 16, 12, 0, 0, 0],
            'YOUR_LOOK_LEFT_KEY': [0, 0, 0, 12, 8, 0, 0, 0],
            'YOUR_LOOK_RIGHT_KEY': [0, 0, 0, 12, 16, 0, 0, 0],
            
            # 功能动作 - 自定义你的按键
            'YOUR_ATTACK_KEY': [0, 0, 0, 12, 12, 3, 0, 0],
            'YOUR_JUMP_KEY': [0, 0, 1, 12, 12, 0, 0, 0],
            
            # 组合动作（可选）
            'YOUR_FORWARD_ATTACK_KEY': [1, 0, 0, 12, 12, 3, 0, 0],
        }
```

---

## 🎯 **砍树任务推荐配置**

基于砍树任务的特点，推荐以下最小动作集：

### **必需动作** (7个)
1. ✅ 前进 - 靠近树木
2. ✅ 后退 - 调整距离
3. ✅ 左移/右移 - 绕树移动
4. ✅ 向上看 - 寻找树木
5. ✅ 向下看 - 砍树根
6. ✅ 向左/右看 - 扫视寻找树木
7. ✅ 攻击 - 砍树

### **可选动作** (3个)
8. ⭐ 前进+攻击 - 快捷组合
9. ⭐ 向上看+攻击 - 砍高处
10. ⚪ 跳跃 - 越过障碍（少用）

### **推荐按键布局**

```
移动:        视角:        功能:
  W(前)        I(上)        F(攻击)
A S D      J     L(左右)    Space(跳)
(左后右)       K(下)        

组合:
  Q(前进+攻击)
  E(向上看+攻击)
```

---

## 📊 **相机角度参考**

### **Pitch（俯仰）范围**

```
   向上
     ↑
     8  (-60度) - 看天空/树顶
    10  (-30度) - 看树冠
    12  (  0度) - 水平视线 ⭐ 默认
    14  (+30度) - 看地面/树根
    16  (+60度) - 看脚下
     ↓
   向下
```

### **Yaw（偏航）范围**

```
   向左 ←      → 向右
         8  (-60度) - 左转
        10  (-30度) - 微左转
        12  (  0度) - 正前方 ⭐ 默认
        14  (+30度) - 微右转
        16  (+60度) - 右转
```

### **推荐砍树视角**

```python
# 寻找树木阶段
pitch = 10  # 微向上看（看树干中部）
yaw = 12    # 正前方

# 对准树木阶段
pitch = 12  # 水平视角（对准树干）
yaw = 12    # 正前方

# 砍树阶段
pitch = 12-14  # 水平到微向下（树干最粗的部分）
yaw = 12       # 正前方
```

---

## 🔬 **验证其他functional值的方法**

如果你想探索其他functional值（1, 2, 4-7），可以创建测试脚本：

```python
import minedojo
import numpy as np
import time

env = minedojo.make(task_id="harvest_1_log")
obs = env.reset()

# 测试每个functional值
for func_value in range(8):
    print(f"\n测试 functional={func_value}...")
    
    for _ in range(10):  # 连续执行10次
        action = np.array([0, 0, 0, 12, 12, func_value, 0, 0])
        obs, reward, done, info = env.step(action)
        time.sleep(0.1)
    
    input(f"functional={func_value} 完成，观察效果。按Enter继续...")

env.close()
```

---

## 📚 **参考资源**

- **MineDojo官方文档**: https://docs.minedojo.org/
- **MineDojo GitHub**: https://github.com/MineDojo/MineDojo
- **Minecraft Wiki**: https://minecraft.fandom.com/wiki/Controls

---

## 💡 **总结**

### **当前已确认的动作**
- ✅ 移动: forward(1), back(2), left(1), right(2)
- ✅ 跳跃: jump=1
- ✅ 视角: pitch(0-24), yaw(0-24)，中心=12
- ✅ 攻击: functional=3

### **待验证的动作**
- ❓ functional=1, 2, 4-7
- ❓ jump=2, 3
- ❓ craft(1-243)
- ❓ smelt(1-35)

### **推荐用于录制**
- ⭐ **方案A (WASD+IJKL)** - 已实现，推荐继续使用
- 如需调整，参考上面的自定义模板

---

**更新日期**: 2025-10-21  
**状态**: 已验证基础动作，可用于DAgger录制 ✅


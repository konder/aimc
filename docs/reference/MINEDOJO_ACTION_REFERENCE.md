# MineDojo 动作空间完整参考

> **来源**: [MineDojo官方文档 - Action Space](https://docs.minedojo.org/sections/core_api/action_space.html)  
> **状态**: ✅ 已验证官方定义，可用于DAgger录制和训练  
> **更新日期**: 2025-10-23

---

## 📋 **目录**

1. [重要修正](#-重要修正)
2. [官方完整定义](#-官方完整定义)
3. [8维动作详解](#-8维动作详解)
4. [按键映射方案](#-按键映射方案)
5. [常用动作组合](#-常用动作组合)
6. [验证方法](#-验证方法)
7. [参考资源](#-参考资源)

---

## ⚠️ **重要修正**

对照官方文档，我们之前的理解有以下**错误**：

### **❌ 错误1: Jump维度的理解**
```python
# ❌ 我们之前认为:
# [2] jump: 0=不跳, 1=跳跃, 2=?, 3=?

# ✅ 官方正确定义:
# [2] Jump, sneak, and sprint: 
#     0=noop, 1=jump, 2=sneak, 3=sprint
```

### **❌ 错误2: Functional动作的理解**
```python
# ❌ 我们之前认为:
# [5] functional: 0=无, 3=攻击, 其他未知

# ✅ 官方正确定义:
# [5] Functional actions:
#     0=noop
#     1=use (使用物品/放置方块)
#     2=drop (丢弃物品)
#     3=attack (攻击) ✅ 我们验证正确
#     4=craft (合成)
#     5=equip (装备)
#     6=place (放置)
#     7=destroy (销毁)
```

### **❌ 错误3: Craft和Smelt的关系**
```python
# ❌ 我们之前认为:
# [6] craft: 合成
# [7] smelt: 熔炼

# ✅ 官方正确定义:
# [6] Argument for "craft": 244个合成配方（包含熔炉）
# [7] Argument for "equip", "place", "destroy": 36个物品栏槽位
```

---

## 📊 **官方完整定义**

```python
MultiDiscrete([3, 3, 4, 25, 25, 8, 244, 36])
```

| 索引 | 名称 | 详细说明 | 取值范围 |
|------|------|---------|---------|
| 0 | **Forward/Backward** | 前后移动 | 3个选项 |
| | | 0: noop (停止) | |
| | | 1: forward (前进) | |
| | | 2: back (后退) | |
| 1 | **Left/Right** | 左右移动 | 3个选项 |
| | | 0: noop (停止) | |
| | | 1: move left (左移) | |
| | | 2: move right (右移) | |
| 2 | **Jump/Sneak/Sprint** | 跳跃/潜行/疾跑 | 4个选项 |
| | | 0: noop (无) | |
| | | 1: jump (跳跃) | |
| | | 2: sneak (潜行) ⭐ | |
| | | 3: sprint (疾跑) ⭐ | |
| 3 | **Camera Delta Pitch** | 相机俯仰角增量 | 25个选项 |
| | | 0: -180度 | |
| | | 12: 0度 (中心) ⭐ | |
| | | 24: +180度 | |
| 4 | **Camera Delta Yaw** | 相机偏航角增量 | 25个选项 |
| | | 0: -180度 | |
| | | 12: 0度 (中心) ⭐ | |
| | | 24: +180度 | |
| 5 | **Functional Actions** | 功能动作 | 8个选项 |
| | | 0: noop (无动作) | |
| | | 1: use (使用物品) ⭐ | |
| | | 2: drop (丢弃物品) ⭐ | |
| | | 3: attack (攻击/挖掘) ✅ | |
| | | 4: craft (合成) ⭐ | |
| | | 5: equip (装备物品) ⭐ | |
| | | 6: place (放置方块) ⭐ | |
| | | 7: destroy (销毁物品) ⭐ | |
| 6 | **Craft Argument** | 合成配方参数 | 244个配方 |
| | | 0: 无合成 | |
| | | 1-243: 各种物品的合成配方 | |
| | | (包含工作台和熔炉配方) | |
| 7 | **Inventory Argument** | 物品栏参数 | 36个槽位 |
| | | 用于 equip/place/destroy | |
| | | 0-35: 物品栏槽位索引 | |

---

## 🎯 **8维动作详解**

### **维度0: forward_back (前后移动)**
```
范围: 0-2 (共3个选项)
├─ 0: 停止
├─ 1: 前进 (W键)
└─ 2: 后退 (S键)
```

**组合移动**:
- `[1, 0, ...]` - 前进
- `[2, 0, ...]` - 后退
- `[1, 1, ...]` - 前进+左移（斜向移动）
- `[1, 2, ...]` - 前进+右移（斜向移动）

---

### **维度1: left_right (左右移动)**
```
范围: 0-2 (共3个选项)
├─ 0: 停止
├─ 1: 左移 (A键)
└─ 2: 右移 (D键)
```

---

### **维度2: jump_sneak_sprint (跳跃/潜行/疾跑)**
```
范围: 0-3 (共4个选项)
├─ 0: noop (无)
├─ 1: jump (跳跃) - Space键
├─ 2: sneak (潜行) - 隐蔽或慢速移动
└─ 3: sprint (疾跑) - 快速移动
```

**常用组合**:
- `[1, 0, 1, ...]` - 跳跃前进
- `[1, 0, 2, ...]` - 潜行前进
- `[1, 0, 3, ...]` - 疾跑前进

---

### **维度3: pitch (相机俯仰角 - 上下看)**
```
范围: 0-24 (共25个选项)
├─ 0-11: 向上看 (数值越小越向上)
├─ 12: 水平视角 (中心位置) ⭐ 默认
└─ 13-24: 向下看 (数值越大越向下)
```

**常用值**:
- `8` - 向上看 (I键, -4单位, ≈-60度)
- `10` - 微向上看 (-2单位, ≈-30度)
- `12` - 水平视角 (中心, 0度)
- `14` - 微向下看 (+2单位, ≈+30度)
- `16` - 向下看 (K键, +4单位, ≈+60度)

**角度计算公式**:
```python
angle = (value - 12) * 15 度

# 示例
pitch=0  → (0-12)*15  = -180度 (最大向上)
pitch=8  → (8-12)*15  = -60度  (向上看)
pitch=12 → (12-12)*15 = 0度    (水平)
pitch=16 → (16-12)*15 = +60度  (向下看)
pitch=24 → (24-12)*15 = +180度 (最大向下)
```

---

### **维度4: yaw (相机偏航角 - 左右看)**
```
范围: 0-24 (共25个选项)
├─ 0-11: 向左转 (数值越小越向左)
├─ 12: 正前方 (中心位置) ⭐ 默认
└─ 13-24: 向右转 (数值越大越向右)
```

**常用值**:
- `8` - 向左看 (J键, -4单位, ≈-60度)
- `10` - 微向左看 (-2单位, ≈-30度)
- `12` - 正前方 (中心, 0度)
- `14` - 微向右看 (+2单位, ≈+30度)
- `16` - 向右看 (L键, +4单位, ≈+60度)

---

### **维度5: functional (功能动作)** ⭐ **重要**

| 值 | 动作 | 验证状态 | 说明 |
|----|------|----------|------|
| 0 | 无动作 | ✅ | 默认状态 |
| 1 | 使用物品 | ✅ | 右键使用/放置方块 |
| 2 | 丢弃物品 | ✅ | 从物品栏丢弃 |
| **3** | **攻击/挖掘** | **✅ 已确认** | **砍树、挖方块** ⭐ |
| 4 | 合成 | ✅ | 使用合成配方 |
| 5 | 装备物品 | ✅ | 装备到手中 |
| 6 | 放置方块 | ✅ | 从物品栏放置 |
| 7 | 销毁物品 | ✅ | 销毁物品栏物品 |

---

### **维度6: craft (合成配方参数)**
```
范围: 0-243 (共244个合成配方)
├─ 0: 无合成
└─ 1-243: 各种物品的合成配方ID
           (包含工作台和熔炉配方)
```

**砍树任务**: 通常不需要，保持为0

---

### **维度7: inventory (物品栏参数)**
```
范围: 0-35 (共36个物品栏槽位)
├─ 0-35: 物品栏槽位索引
└─ 用于 equip/place/destroy 动作的参数
```

**砍树任务**: 不需要，保持为0

---

## 🎮 **按键映射方案**

### **方案A: WASD移动 + IJKL视角** (当前使用) ✅

```python
# 移动控制
'w' → [1, 0, 0, 12, 12, 0, 0, 0]  # 前进
's' → [2, 0, 0, 12, 12, 0, 0, 0]  # 后退
'a' → [0, 1, 0, 12, 12, 0, 0, 0]  # 左移
'd' → [0, 2, 0, 12, 12, 0, 0, 0]  # 右移

# 视角控制
'i' → [0, 0, 0, 8, 12, 0, 0, 0]   # 向上看
'k' → [0, 0, 0, 16, 12, 0, 0, 0]  # 向下看
'j' → [0, 0, 0, 12, 8, 0, 0, 0]   # 向左看
'l' → [0, 0, 0, 12, 16, 0, 0, 0]  # 向右看

# 功能动作
'f' → [0, 0, 0, 12, 12, 3, 0, 0]  # 攻击/砍树 ✅
' ' (空格) → [0, 0, 1, 12, 12, 0, 0, 0]  # 跳跃

# 可选增强动作
'shift' → [0, 0, 3, 12, 12, 0, 0, 0]  # 疾跑 (快速靠近树木)
'c' → [0, 0, 2, 12, 12, 0, 0, 0]      # 潜行 (精确对准树干)
```

**优点**:
- ✅ 符合传统FPS游戏习惯
- ✅ 左手WASD移动，右手IJKL视角，F攻击
- ✅ 避免按键冲突

**缺点**:
- ⚠️ IJKL不如方向键直观
- ⚠️ 右手需要在键盘右侧

---

### **推荐按键布局**

```
移动:        视角:        功能:
  W(前)        I(上)        F(攻击)
A S D      J     L(左右)    Space(跳)
(左后右)       K(下)        Shift(疾跑)
                           C(潜行)
```

---

### **砍树任务推荐配置**

#### **必需动作** (7个)
1. ✅ 前进 - 靠近树木
2. ✅ 后退 - 调整距离
3. ✅ 左移/右移 - 绕树移动
4. ✅ 向上看 - 寻找树木
5. ✅ 向下看 - 砍树根
6. ✅ 向左/右看 - 扫视寻找树木
7. ✅ 攻击 - 砍树

#### **可选动作** (3个)
8. ⭐ 疾跑 - 快速靠近树木
9. ⭐ 潜行 - 精确对准树干
10. ⚪ 跳跃 - 越过障碍（少用）

---

## 📝 **常用动作组合**

### **基础移动**

```python
# 停止/静止
[0, 0, 0, 12, 12, 0, 0, 0]

# 前进
[1, 0, 0, 12, 12, 0, 0, 0]

# 后退
[2, 0, 0, 12, 12, 0, 0, 0]

# 左移
[0, 1, 0, 12, 12, 0, 0, 0]

# 右移
[0, 2, 0, 12, 12, 0, 0, 0]

# 前进+左移（斜向）
[1, 1, 0, 12, 12, 0, 0, 0]

# 前进+右移（斜向）
[1, 2, 0, 12, 12, 0, 0, 0]
```

---

### **视角控制**

```python
# 向上看（寻找树木）
[0, 0, 0, 8, 12, 0, 0, 0]

# 向下看（看地面/树根）
[0, 0, 0, 16, 12, 0, 0, 0]

# 向左看
[0, 0, 0, 12, 8, 0, 0, 0]

# 向右看
[0, 0, 0, 12, 16, 0, 0, 0]

# 向上+向左看（左上角）
[0, 0, 0, 8, 8, 0, 0, 0]

# 向下+向右看（右下角）
[0, 0, 0, 16, 16, 0, 0, 0]
```

---

### **跳跃和移动**

```python
# 原地跳跃
[0, 0, 1, 12, 12, 0, 0, 0]

# 前进跳跃（跳过障碍）
[1, 0, 1, 12, 12, 0, 0, 0]

# 疾跑前进
[1, 0, 3, 12, 12, 0, 0, 0]

# 潜行前进
[1, 0, 2, 12, 12, 0, 0, 0]
```

---

### **砍树动作组合**

```python
# 静止攻击（已对准树木）
[0, 0, 0, 12, 12, 3, 0, 0]

# 前进+攻击（靠近并砍树）
[1, 0, 0, 12, 12, 3, 0, 0]

# 向上看+攻击（砍高处树叶）
[0, 0, 0, 8, 12, 3, 0, 0]

# 向下看+攻击（砍树根）
[0, 0, 0, 16, 12, 3, 0, 0]

# 左移+攻击（绕树砍）
[0, 1, 0, 12, 12, 3, 0, 0]
```

---

## 🔬 **验证方法**

### **在录制工具中验证**

1. 按`F`键 → 显示 `Actions: attack`
2. Action数组显示 `[0 0 0 12 12 3 0 0]`
3. 角色执行攻击动画（手臂挥动）
4. 可以砍断树木

### **在训练代码中使用**

```python
import numpy as np

# 创建攻击动作
attack_action = np.array([0, 0, 0, 12, 12, 3, 0, 0], dtype=np.int32)

# 验证动作有效性
assert env.action_space.contains(attack_action)

# 执行攻击
obs, reward, done, info = env.step(attack_action)
```

### **测试其他功能动作**

```python
import minedojo
import numpy as np
import time

env = minedojo.make(task_id="harvest_1_log")
obs = env.reset()

# 测试每个functional值
for func_value in range(8):
    print(f"\n测试 functional={func_value}...")
    
    for _ in range(10):  # 连续执行10次
        action = np.array([0, 0, 0, 12, 12, func_value, 0, 0])
        obs, reward, done, info = env.step(action)
        time.sleep(0.1)
    
    input(f"functional={func_value} 完成，观察效果。按Enter继续...")

env.close()
```

---

## 📊 **相机角度参考图**

### **Pitch（俯仰）范围**

```
   向上
     ↑
     0  (-180度) - 最大向上
     8  (-60度)  - 看天空/树顶 (I键)
    10  (-30度)  - 看树冠
    12  (  0度)  - 水平视线 ⭐ 默认
    14  (+30度)  - 看地面/树根
    16  (+60度)  - 看脚下 (K键)
    24  (+180度) - 最大向下
     ↓
   向下
```

### **Yaw（偏航）范围**

```
   向左 ←      → 向右
     0  (-180度) - 最大向左
     8  (-60度)  - 左转 (J键)
    10  (-30度)  - 微左转
    12  (  0度)  - 正前方 ⭐ 默认
    14  (+30度)  - 微右转
    16  (+60度)  - 右转 (L键)
    24  (+180度) - 最大向右
```

### **推荐砍树视角**

```python
# 寻找树木阶段
pitch = 10  # 微向上看（看树干中部）
yaw = 12    # 正前方

# 对准树木阶段
pitch = 12  # 水平视角（对准树干）
yaw = 12    # 正前方

# 砍树阶段
pitch = 12-14  # 水平到微向下（树干最粗的部分）
yaw = 12       # 正前方
```

---

## 📚 **复合动作空间设计**

### **官方说明**

引用官方文档：

> "We design a compound action space. At each step the agent chooses **one movement action** (forward, backward, camera actions, etc.) and **one optional functional action** (attack, use, craft, etc.)."

这意味着：
- ✅ 可以同时执行移动和功能动作
- ✅ 例如：`[1, 0, 0, 12, 12, 3, 0, 0]` = 前进 + 攻击 ✅ 正确

---

## 🎯 **Action Masks（动作掩码）**

官方提供了动作掩码来指示哪些动作是有效的：

```python
# 功能动作掩码
obs["masks"]["action_type"]       # 形状: (8,)

# 动作参数掩码
obs["masks"]["action_arg"]        # 形状: (8, 1)

# 装备掩码
obs["masks"]["equip"]             # 形状: (36,)

# 放置掩码
obs["masks"]["place"]             # 形状: (36,)

# 销毁掩码
obs["masks"]["destroy"]           # 形状: (36,)

# 合成/熔炼掩码
obs["masks"]["craft_smelt"]       # 形状: (244,)
```

---

## ⚠️ **注意事项**

1. **持续攻击**: 砍树需要连续多次攻击动作
2. **对准目标**: 十字准心需要对准树干
3. **距离限制**: 需要靠近目标才能攻击
4. **动作组合**: 可以同时移动和攻击

---

## 📚 **参考资源**

- **MineDojo官方文档**: https://docs.minedojo.org/
- **Action Space API**: https://docs.minedojo.org/sections/core_api/action_space.html
- **Observation Space API**: https://docs.minedojo.org/sections/core_api/observation_space.html
- **MineDojo GitHub**: https://github.com/MineDojo/MineDojo
- **Minecraft Wiki**: https://minecraft.fandom.com/wiki/Controls

---

## ✅ **验证结果总结**

### **我们正确的部分** ✅
1. ✅ 维度0-1（前后左右移动）- 完全正确
2. ✅ 维度3-4（相机pitch/yaw）- 完全正确
3. ✅ 维度5=3（攻击动作）- 已验证正确
4. ✅ 组合动作（移动+攻击）- 正确理解

### **我们错误的部分** ❌
1. ❌ 维度2：不仅是跳跃，还包括**潜行(2)**和**疾跑(3)**
2. ❌ 维度5：其他功能动作的含义未知 → 官方已明确定义
3. ❌ 维度7：不是smelt，而是**inventory槽位参数**

### **新发现的可用动作** ⭐
1. ⭐ **Sneak (潜行)**: `action[2] = 2` - 可用于隐蔽或慢速移动
2. ⭐ **Sprint (疾跑)**: `action[2] = 3` - 可用于快速移动
3. ⭐ **Use (使用)**: `action[5] = 1` - 右键使用物品
4. ⭐ **Drop (丢弃)**: `action[5] = 2` - 丢弃物品
5. ⭐ **Equip (装备)**: `action[5] = 5` + `action[7] = slot` - 装备物品
6. ⭐ **Place (放置)**: `action[5] = 6` + `action[7] = slot` - 放置方块
7. ⭐ **Destroy (销毁)**: `action[5] = 7` + `action[7] = slot` - 销毁物品

---

## 💡 **总结**

### **当前已确认的动作**
- ✅ 移动: forward(1), back(2), left(1), right(2)
- ✅ 跳跃/潜行/疾跑: jump(1), sneak(2), sprint(3)
- ✅ 视角: pitch(0-24), yaw(0-24)，中心=12
- ✅ 功能动作: use(1), drop(2), attack(3), craft(4), equip(5), place(6), destroy(7)
- ✅ 合成参数: craft_arg(0-243)
- ✅ 物品栏参数: inventory_arg(0-35)

### **推荐用于录制**
- ⭐ **WASD+IJKL方案** - 已实现，推荐继续使用
- 基础动作足够完成砍树任务
- 可选添加疾跑和潜行提升效率

---

**最后更新**: 2025-10-23  
**验证状态**: ✅ 已完成，可用于DAgger录制和训练


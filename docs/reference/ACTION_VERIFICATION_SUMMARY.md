# MineDojo动作空间验证总结

> **验证日期**: 2025-10-21  
> **官方文档**: https://docs.minedojo.org/sections/core_api/action_space.html  
> **验证状态**: ✅ 已完成并修正错误

---

## 🎯 **验证结论**

### ✅ **我们正确的部分**
1. ✅ **移动控制** (维度0-1) - 完全正确
2. ✅ **相机控制** (维度3-4) - 完全正确
3. ✅ **攻击动作** (functional=3) - 已验证有效
4. ✅ **组合动作** (移动+攻击) - 理解正确
5. ✅ **WASD+IJKL按键布局** - 设计合理

### ❌ **我们的错误**
1. ❌ **维度2误解**: 
   - 我们以为只是"jump"
   - 实际是"jump/sneak/sprint"三合一

2. ❌ **维度5功能动作**: 
   - 我们只知道0=noop, 3=attack
   - 实际有8个明确定义的功能

3. ❌ **维度7误解**: 
   - 我们以为是"smelt"（熔炼）
   - 实际是"inventory argument"（物品栏槽位）

---

## 📊 **官方完整定义对照表**

| 维度 | 我们之前的理解 | 官方正确定义 | 状态 |
|------|--------------|-------------|------|
| 0 | forward/back (0-2) | Forward/Backward (0-2) | ✅ 正确 |
| 1 | left/right (0-2) | Left/Right (0-2) | ✅ 正确 |
| 2 | jump (0-3) | **Jump/Sneak/Sprint** (0-3) | ⚠️ 部分错误 |
| 3 | pitch (0-24) | Camera Pitch (0-24) | ✅ 正确 |
| 4 | yaw (0-24) | Camera Yaw (0-24) | ✅ 正确 |
| 5 | functional (0-7) | **8种功能动作** | ⚠️ 部分错误 |
| 6 | craft (0-243) | **Craft Argument** | ✅ 正确 |
| 7 | ~~smelt (0-35)~~ | **Inventory Argument** | ❌ 完全错误 |

---

## 🔍 **详细对照**

### **维度2: Jump/Sneak/Sprint**

```python
# ❌ 我们之前:
# 0=noop, 1=jump, 2=?, 3=?

# ✅ 官方定义:
0: noop (无)
1: jump (跳跃) ✅ 我们已用
2: sneak (潜行) ⭐ 新发现
3: sprint (疾跑) ⭐ 新发现
```

**影响**: 
- 可以添加潜行按键（精确对准）
- 可以添加疾跑按键（快速移动）

---

### **维度5: Functional Actions**

```python
# ❌ 我们之前:
# 0=noop, 3=attack✅, 其他未知

# ✅ 官方定义:
0: noop (无动作)
1: use (使用物品) ⭐ 新发现
2: drop (丢弃物品) ⭐ 新发现
3: attack (攻击/挖掘) ✅ 我们已验证
4: craft (合成) ⭐ 新发现 - 需要arg[6]
5: equip (装备物品) ⭐ 新发现 - 需要arg[7]
6: place (放置方块) ⭐ 新发现 - 需要arg[7]
7: destroy (销毁物品) ⭐ 新发现 - 需要arg[7]
```

**影响**:
- 砍树任务只需要attack(3)
- 未来复杂任务可用其他功能

---

### **维度6-7: Arguments关系**

```python
# ❌ 我们之前:
# [6] craft配方ID (0-243)
# [7] smelt配方ID (0-35)

# ✅ 官方定义:
# [6] craft的参数 (0-243个配方)
#     - 包含工作台和熔炉的所有配方
#     - 只在functional=4时使用
# 
# [7] inventory的参数 (0-35个槽位)
#     - 用于equip(5), place(6), destroy(7)
#     - 指定物品栏的哪个槽位
```

**官方说明**:
> "We merge the action of using a furnace to craft items (a.k.a., smelt) into 'craft' action for simplicity."

**影响**:
- 维度7不是独立的smelt
- 而是指定inventory槽位索引
- craft包含了所有合成和熔炼

---

## 📐 **相机角度公式验证**

### **官方公式**

```
angle_degrees = (value - 12) * 15
```

### **对照我们的理解**

| Value | 我们的理解 | 官方公式 | 验证 |
|-------|----------|---------|------|
| 0 | 最大向上 | (0-12)*15 = -180° | ✅ 一致 |
| 8 | 向上看(-60°) | (8-12)*15 = -60° | ✅ 一致 |
| 12 | 水平 | (12-12)*15 = 0° | ✅ 一致 |
| 16 | 向下看(+60°) | (16-12)*15 = +60° | ✅ 一致 |
| 24 | 最大向下 | (24-12)*15 = +180° | ✅ 一致 |

**结论**: 我们的理解完全正确 ✅

---

## 🎮 **更新后的按键建议**

### **保持不变（已验证正确）**

```python
# 基础移动
'w' → [1, 0, 0, 12, 12, 0, 0, 0]  # 前进 ✅
's' → [2, 0, 0, 12, 12, 0, 0, 0]  # 后退 ✅
'a' → [0, 1, 0, 12, 12, 0, 0, 0]  # 左移 ✅
'd' → [0, 2, 0, 12, 12, 0, 0, 0]  # 右移 ✅

# 视角控制
'i' → [0, 0, 0, 8, 12, 0, 0, 0]   # 向上看 ✅
'k' → [0, 0, 0, 16, 12, 0, 0, 0]  # 向下看 ✅
'j' → [0, 0, 0, 12, 8, 0, 0, 0]   # 向左看 ✅
'l' → [0, 0, 0, 12, 16, 0, 0, 0]  # 向右看 ✅

# 功能动作
'f' → [0, 0, 0, 12, 12, 3, 0, 0]  # 攻击 ✅
' ' → [0, 0, 1, 12, 12, 0, 0, 0]  # 跳跃 ✅

# 组合动作
'q' → [1, 0, 0, 12, 12, 3, 0, 0]  # 前进+攻击 ✅
'e' → [0, 0, 0, 8, 12, 3, 0, 0]   # 向上看+攻击 ✅
```

### **可选新增（官方已确认）**

```python
# 移动增强
'c' → [0, 0, 2, 12, 12, 0, 0, 0]      # 潜行 ⭐
'shift' → [0, 0, 3, 12, 12, 0, 0, 0]  # 疾跑 ⭐

# 其他功能（未来可用）
'r' → [0, 0, 0, 12, 12, 1, 0, 0]  # 使用物品 ⭐
't' → [0, 0, 0, 12, 12, 2, 0, 0]  # 丢弃物品 ⭐
```

---

## 📝 **对砍树任务的影响**

### **必需动作（不变）**
- ✅ 移动: WASD
- ✅ 视角: IJKL
- ✅ 攻击: F
- ✅ 跳跃: Space

### **可选增强（新）**
- ⭐ **潜行(C)**: 慢速移动，精确对准树干
- ⭐ **疾跑(Shift)**: 快速靠近树木

### **无需修改录制工具**
- 当前工具已经够用
- 新功能可按需添加
- 不影响现有录制流程

---

## 🔗 **Action Masks（官方提供）**

官方还提供了动作掩码系统：

```python
# 可用功能动作掩码
obs["masks"]["action_type"]       # (8,) bool

# 动作参数掩码
obs["masks"]["action_arg"]        # (8, 1) bool

# 装备掩码
obs["masks"]["equip"]             # (36,) bool

# 放置掩码
obs["masks"]["place"]             # (36,) bool

# 销毁掩码
obs["masks"]["destroy"]           # (36,) bool

# 合成/熔炼掩码
obs["masks"]["craft_smelt"]       # (244,) bool
```

**用途**: 
- 告诉agent哪些动作当前可用
- 防止执行无效动作
- 提高训练效率

**建议**: 
- BC/DAgger训练可暂时不用
- 复杂任务或PPO训练时考虑使用

---

## ✅ **修正清单**

### **已更新的文件**
1. ✅ `config/keyboard_mapping.yaml` - 更新动作定义
2. ✅ `docs/reference/MINEDOJO_ACTION_SPACE_OFFICIAL.md` - 官方定义文档
3. ✅ `docs/reference/ACTION_VERIFICATION_SUMMARY.md` - 本文档

### **待更新的文件**（可选）
1. ⚪ `docs/reference/MINEDOJO_COMPLETE_ACTION_REFERENCE.md` - 可添加新发现
2. ⚪ `KEYBOARD_REFERENCE_CARD.md` - 可添加可选动作
3. ⚪ `tools/record_manual_chopping.py` - 可添加sneak/sprint（非必需）

---

## 💡 **建议**

### **对于当前DAgger录制**
1. ✅ **保持现有配置** - 已验证的动作足够
2. ✅ **不需要修改代码** - 当前工具完全可用
3. ⚪ **可选**: 添加疾跑键（Shift）快速接近树木

### **对于未来任务**
1. ⭐ 可以使用`use(1)`进行交互
2. ⭐ 可以使用`equip(5)`切换工具
3. ⭐ 可以使用`craft(4)`合成物品
4. ⭐ 可以使用action masks优化策略

---

## 📚 **参考资源**

- **官方文档**: https://docs.minedojo.org/sections/core_api/action_space.html
- **Observation Space**: https://docs.minedojo.org/sections/core_api/observation_space.html
- **MineDojo GitHub**: https://github.com/MineDojo/MineDojo

---

## 🎯 **总结**

### **验证成果**
- ✅ 发现并修正3个错误理解
- ✅ 确认7个新的可用动作
- ✅ 验证了相机角度公式
- ✅ 更新了所有配置文档

### **实际影响**
- ✅ 当前录制工具无需修改
- ✅ 砍树任务完全够用
- ⭐ 未来有更多功能可用

### **下一步**
- ✅ 可以开始录制专家演示
- ✅ 使用当前WASD+IJKL+F配置
- ⚪ 可选添加疾跑键加速

---

**验证完成！** ✅  
**可以安心开始DAgger录制了！** 🎮


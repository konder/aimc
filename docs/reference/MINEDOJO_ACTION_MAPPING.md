# MineDojo 动作空间映射

> **已验证**: functional=3 是攻击动作 ✅

---

## 📊 **MineDojo Action Space**

```
MultiDiscrete([3, 3, 4, 25, 25, 8, 244, 36])
```

### **动作维度说明**

| 索引 | 名称 | 范围 | 说明 |
|------|------|------|------|
| 0 | forward/back | 0-2 | 0=停止, 1=前进, 2=后退 |
| 1 | left/right | 0-2 | 0=停止, 1=左移, 2=右移 |
| 2 | jump | 0-3 | 0=无, 1=跳跃, 2=?, 3=疾跑跳跃? |
| 3 | pitch | 0-24 | 相机俯仰角 (12=中心) |
| 4 | yaw | 0-24 | 相机偏航角 (12=中心) |
| 5 | **functional** | **0-7** | **功能动作** ⭐ |
| 6 | craft | 0-243 | 合成动作 |
| 7 | smelt | 0-35 | 熔炼动作 |

---

## ⚔️ **Functional 动作映射（已验证）**

| 值 | 动作 | 验证状态 | 说明 |
|----|------|----------|------|
| 0 | 无动作 | ✅ | 默认状态 |
| 1 | ❓ | ⚠️ | 未知功能 |
| 2 | ❓ | ⚠️ | 未知功能 |
| **3** | **攻击/挖掘** | **✅ 已确认** | **砍树、挖方块** ⭐ |
| 4 | ❓ | ⚠️ | 未知功能 |
| 5 | ❓ | ⚠️ | 未知功能 |
| 6 | ❓ | ⚠️ | 未知功能 |
| 7 | ❓ | ⚠️ | 未知功能 |

---

## 🎮 **录制工具中的映射**

### **键盘 → 动作**

```python
# 移动控制
'w' → action[0] = 1  # 前进
's' → action[0] = 2  # 后退
'a' → action[1] = 1  # 左移
'd' → action[1] = 2  # 右移

# 相机控制
'i' → action[3] = 8   # 向上看
'k' → action[3] = 16  # 向下看
'j' → action[4] = 8   # 向左看
'l' → action[4] = 16  # 向右看

# 功能动作
'f' → action[5] = 3   # 攻击/砍树 ✅
```

### **示例动作**

```python
# 静止状态
[0, 0, 0, 12, 12, 0, 0, 0]

# 前进
[1, 0, 0, 12, 12, 0, 0, 0]

# 攻击（砍树）
[0, 0, 0, 12, 12, 3, 0, 0]

# 前进 + 攻击
[1, 0, 0, 12, 12, 3, 0, 0]

# 向左看 + 攻击
[0, 0, 0, 12, 8, 3, 0, 0]
```

---

## 🔬 **验证方法**

使用测试脚本验证其他functional值：

```bash
python tools/test_attack_actions.py
```

---

## 📝 **使用说明**

### **在录制工具中**

1. 按`F`键 → 显示 `Actions: attack`
2. Action数组显示 `[0 0 0 12 12 3 0 0]`
3. 角色执行攻击动画（手臂挥动）
4. 可以砍断树木

### **在训练代码中**

如果需要在其他地方使用攻击动作：

```python
import numpy as np

# 创建攻击动作
attack_action = np.array([0, 0, 0, 12, 12, 3, 0, 0], dtype=np.int32)

# 验证动作有效性
assert env.action_space.contains(attack_action)

# 执行攻击
obs, reward, done, info = env.step(attack_action)
```

---

## ⚠️ **注意事项**

1. **持续攻击**: 砍树需要连续多次攻击动作
2. **对准目标**: 十字准心需要对准树干
3. **距离限制**: 需要靠近目标才能攻击
4. **动作组合**: 可以同时移动和攻击

---

## 🎯 **下一步**

现在攻击动作已确认有效，可以：

1. ✅ **录制完整砍树序列**
2. ✅ **验证MineCLIP效果**
3. ✅ **开始16帧视频模式训练**

```bash
python tools/record_manual_chopping.py --output-dir logs/my_chopping
```

# DAgger å®æ–½è®¡åˆ’

> **ç›®æ ‡**: ä½¿ç”¨DAggerç®—æ³•å°†ç æ ‘ä»»åŠ¡æˆåŠŸç‡ä»60%æå‡åˆ°90%+

---

## ğŸ“‹ **å®æ–½è·¯çº¿å›¾**

### **é˜¶æ®µ0: å‡†å¤‡å·¥ä½œ** âœ… å·²å®Œæˆ
- âœ… æ‰‹åŠ¨å½•åˆ¶å·¥å…·å·²å°±ç»ª (`tools/record_manual_chopping.py`)
- âœ… MineCLIPéªŒè¯å·¥å…·å·²å®Œæˆ (`tools/verify_mineclip_16frames.py`)
- âœ… ç¯å¢ƒåŒ…è£…å™¨å·²å®Œå–„ (`src/utils/env_wrappers.py`)
- âœ… DAggerç†è®ºæ–‡æ¡£å·²å®Œæˆ

---

### **é˜¶æ®µ1: BCåˆå§‹è®­ç»ƒ** (é¢„è®¡1-2å¤©)

#### **ä»»åŠ¡1.1: å½•åˆ¶ä¸“å®¶æ¼”ç¤º** 
```bash
æ—¶é—´: 1å°æ—¶
ç›®æ ‡: 10æ¬¡æˆåŠŸç æ ‘æ¼”ç¤º
å·¥å…·: tools/record_manual_chopping.py

æ­¥éª¤:
1. python tools/record_manual_chopping.py --output data/expert_demos/round_0/
2. æ¯æ¬¡å½•åˆ¶ ~200-500 æ­¥ï¼ˆæ‰¾æ ‘ â†’ é è¿‘ â†’ ç æ ‘ â†’ è·å¾—æœ¨å¤´ï¼‰
3. ç¡®ä¿åŒ…å«ä¸åŒåœºæ™¯ï¼š
   - è¿‘è·ç¦»çœ‹åˆ°æ ‘
   - ä¸­è·ç¦»å¯»æ‰¾æ ‘
   - ä¸åŒæ ‘æœ¨ç±»å‹
```

**è¾“å‡º**: 
- `data/expert_demos/round_0/episode_*.npy` (10ä¸ªæ–‡ä»¶)
- æ€»å¸§æ•°: ~4000-5000å¸§

---

#### **ä»»åŠ¡1.2: å®ç°BCè®­ç»ƒè„šæœ¬**
```bash
æ—¶é—´: 2-3å°æ—¶
æ–‡ä»¶: src/training/train_bc.py
```

**æ ¸å¿ƒåŠŸèƒ½**:
1. åŠ è½½ä¸“å®¶æ¼”ç¤ºæ•°æ®
2. è®­ç»ƒPPO/BCç­–ç•¥ï¼ˆè¡Œä¸ºå…‹éš†ï¼‰
3. ä¿å­˜æ¨¡å‹æ£€æŸ¥ç‚¹

**é¢„æœŸæ•ˆæœ**:
- åˆå§‹æˆåŠŸç‡: ~50-60%
- è®­ç»ƒæ—¶é—´: ~30åˆ†é’Ÿ

---

#### **ä»»åŠ¡1.3: è¯„ä¼°BCç­–ç•¥**
```bash
æ—¶é—´: 30åˆ†é’Ÿ
å·¥å…·: tools/evaluate_policy.py

python tools/evaluate_policy.py \
  --model checkpoints/bc_round_0.zip \
  --episodes 20 \
  --task-id harvest_1_log
```

**å†³ç­–ç‚¹**:
- âœ… æˆåŠŸç‡ â‰¥ 50% â†’ è¿›å…¥é˜¶æ®µ2
- âŒ æˆåŠŸç‡ < 50% â†’ å¢åŠ ä¸“å®¶æ¼”ç¤ºæˆ–è°ƒæ•´è¶…å‚æ•°

---

### **é˜¶æ®µ2: DAggerè¿­ä»£ä¼˜åŒ–** (é¢„è®¡3-5å¤©)

#### **è¿­ä»£1: çº æ­£åç¦»åœºæ™¯**

**æ­¥éª¤1: æ”¶é›†ç­–ç•¥çŠ¶æ€**
```bash
æ—¶é—´: 10åˆ†é’Ÿ
å·¥å…·: tools/run_policy_collect_states.py

python tools/run_policy_collect_states.py \
  --model checkpoints/bc_round_0.zip \
  --episodes 20 \
  --output data/policy_states/iter_1/ \
  --save-failures-only  # åªä¿å­˜å¤±è´¥çš„episode
```

**è¾“å‡º**: 
- å¤±è´¥episodeçš„æ‰€æœ‰çŠ¶æ€
- é¢„è®¡: ~10-15ä¸ªå¤±è´¥episode Ã— 200å¸§ = 2000-3000å¸§

---

**æ­¥éª¤2: æ™ºèƒ½æ ‡æ³¨**
```bash
æ—¶é—´: 30-40åˆ†é’Ÿ
å·¥å…·: tools/label_states.py

python tools/label_states.py \
  --states data/policy_states/iter_1/ \
  --output data/expert_labels/iter_1.pkl \
  --smart-sampling  # æ™ºèƒ½é‡‡æ ·ï¼Œåªæ ‡æ³¨å…³é”®çŠ¶æ€
```

**æ ‡æ³¨ç­–ç•¥**:
- ğŸ”´ **ä¼˜å…ˆ**: å¤±è´¥å‰5-10æ­¥ï¼ˆ100%æ ‡æ³¨ï¼‰
- ğŸŸ¡ **ä¸­ç­‰**: åç¦»è½¨è¿¹çš„çŠ¶æ€ï¼ˆ50%æ ‡æ³¨ï¼‰
- ğŸŸ¢ **ä½ä¼˜å…ˆ**: æ­£å¸¸æ‰§è¡Œï¼ˆè·³è¿‡ï¼Œå·²æœ‰ä¸“å®¶æ¼”ç¤ºï¼‰

**é¢„è®¡æ ‡æ³¨é‡**: 500-800ä¸ªå…³é”®çŠ¶æ€

---

**æ­¥éª¤3: èšåˆæ•°æ®å¹¶é‡æ–°è®­ç»ƒ**
```bash
æ—¶é—´: 30åˆ†é’Ÿ
å·¥å…·: src/training/train_dagger.py

python src/training/train_dagger.py \
  --iteration 1 \
  --base-data data/expert_demos/round_0/ \
  --new-data data/expert_labels/iter_1.pkl \
  --output checkpoints/dagger_iter_1.zip
```

**è¾“å‡º**: 
- æ•°æ®é›†å¤§å°: 5000 + 600 = 5600æ ·æœ¬
- æ–°ç­–ç•¥: `checkpoints/dagger_iter_1.zip`

---

**æ­¥éª¤4: è¯„ä¼°**
```bash
æ—¶é—´: 10åˆ†é’Ÿ

python tools/evaluate_policy.py \
  --model checkpoints/dagger_iter_1.zip \
  --episodes 20
```

**é¢„æœŸç»“æœ**: æˆåŠŸç‡ 60% â†’ **75%** (+15%)

---

#### **è¿­ä»£2: çº æ­£å¤æ‚å¤±è´¥åœºæ™¯**

é‡å¤è¿­ä»£1çš„æ­¥éª¤ï¼Œä½†:
- ç­–ç•¥æ›´å¥½ï¼Œå¤±è´¥æ›´å°‘
- å¤±è´¥åœºæ™¯æ›´å¤æ‚ï¼ˆè¾¹ç•Œæƒ…å†µï¼‰
- æ ‡æ³¨é‡æ›´å°‘ï¼ˆ~300-500ä¸ªçŠ¶æ€ï¼‰

**é¢„æœŸç»“æœ**: æˆåŠŸç‡ 75% â†’ **85%** (+10%)

---

#### **è¿­ä»£3: ç²¾ç»†ä¼˜åŒ–**

é‡å¤è¿­ä»£1çš„æ­¥éª¤ï¼Œä½†:
- ä¸“æ³¨æç«¯è¾¹ç•Œæƒ…å†µ
- æ ‡æ³¨é‡æœ€å°‘ï¼ˆ~200-300ä¸ªçŠ¶æ€ï¼‰

**é¢„æœŸç»“æœ**: æˆåŠŸç‡ 85% â†’ **90%** (+5%)

---

#### **è¿­ä»£4-5: æ”¶æ•›ï¼ˆå¯é€‰ï¼‰**

å¦‚æœè¿˜æœªè¾¾åˆ°90%ï¼Œç»§ç»­è¿­ä»£

**é¢„æœŸç»“æœ**: æˆåŠŸç‡ 90% â†’ **92-95%**

---

### **é˜¶æ®µ3: ï¼ˆå¯é€‰ï¼‰PPOç²¾è°ƒ** (é¢„è®¡1-2å¤©)

å¦‚æœæƒ³è¿›ä¸€æ­¥æå‡åˆ°95%+:

```bash
python src/training/train_get_wood.py \
  --resume \
  --checkpoint checkpoints/dagger_iter_3.zip \
  --total-timesteps 100000 \
  --sparse-weight 1.0 \
  --mineclip-weight 0.0  # çº¯ç¨€ç–å¥–åŠ±
```

ç”¨DAggerç­–ç•¥åˆå§‹åŒ–PPOï¼Œå†è®­ç»ƒ10ä¸‡æ­¥

**é¢„æœŸç»“æœ**: æˆåŠŸç‡ 90% â†’ **95-98%**

---

## ğŸ› ï¸ **éœ€è¦å®ç°çš„å·¥å…·**

### **1. çŠ¶æ€æ”¶é›†å·¥å…·** (ä¼˜å…ˆçº§: ğŸ”´ é«˜)
```
æ–‡ä»¶: tools/run_policy_collect_states.py
åŠŸèƒ½: è¿è¡Œç­–ç•¥å¹¶ä¿å­˜è®¿é—®çš„çŠ¶æ€
é¢„è®¡æ—¶é—´: 1-2å°æ—¶
```

### **2. äº¤äº’å¼æ ‡æ³¨å·¥å…·** (ä¼˜å…ˆçº§: ğŸ”´ é«˜)
```
æ–‡ä»¶: tools/label_states.py
åŠŸèƒ½: æ˜¾ç¤ºçŠ¶æ€ï¼Œæ¥å—é”®ç›˜è¾“å…¥ï¼Œä¿å­˜æ ‡æ³¨
é¢„è®¡æ—¶é—´: 2-3å°æ—¶
```

### **3. BCè®­ç»ƒè„šæœ¬** (ä¼˜å…ˆçº§: ğŸ”´ é«˜)
```
æ–‡ä»¶: src/training/train_bc.py
åŠŸèƒ½: ä»ä¸“å®¶æ¼”ç¤ºè®­ç»ƒç­–ç•¥
é¢„è®¡æ—¶é—´: 1-2å°æ—¶
```

### **4. DAggerä¸»å¾ªç¯** (ä¼˜å…ˆçº§: ğŸŸ¡ ä¸­)
```
æ–‡ä»¶: src/training/train_dagger.py
åŠŸèƒ½: è‡ªåŠ¨åŒ–è¿­ä»£æµç¨‹
é¢„è®¡æ—¶é—´: 2å°æ—¶
```

### **5. ç­–ç•¥è¯„ä¼°å·¥å…·** (ä¼˜å…ˆçº§: ğŸŸ¢ ä½)
```
æ–‡ä»¶: tools/evaluate_policy.py
åŠŸèƒ½: è¯„ä¼°ç­–ç•¥æˆåŠŸç‡
é¢„è®¡æ—¶é—´: 1å°æ—¶
```

---

## ğŸ“Š **é¢„æœŸæ—¶é—´è¡¨**

### **Week 1: BCåŸºçº¿**
- Day 1: å½•åˆ¶ä¸“å®¶æ¼”ç¤ºï¼ˆ1hï¼‰
- Day 2: å®ç°BCè®­ç»ƒè„šæœ¬ï¼ˆ3hï¼‰
- Day 3: è®­ç»ƒBCæ¨¡å‹ï¼Œè¯„ä¼°åŸºçº¿ï¼ˆ2hï¼‰

**é‡Œç¨‹ç¢‘**: BCæˆåŠŸç‡è¾¾åˆ°50-60%

---

### **Week 2: DAggerè¿­ä»£1-2**
- Day 1: å®ç°çŠ¶æ€æ”¶é›†å·¥å…·ï¼ˆ2hï¼‰
- Day 2: å®ç°æ ‡æ³¨å·¥å…·ï¼ˆ3hï¼‰
- Day 3: è¿è¡Œè¿­ä»£1ï¼ˆæ ‡æ³¨40min + è®­ç»ƒ30minï¼‰
- Day 4: è¿è¡Œè¿­ä»£2ï¼ˆæ ‡æ³¨30min + è®­ç»ƒ30minï¼‰

**é‡Œç¨‹ç¢‘**: æˆåŠŸç‡è¾¾åˆ°75-85%

---

### **Week 3: DAggerè¿­ä»£3-4**
- Day 1: è¿è¡Œè¿­ä»£3ï¼ˆæ ‡æ³¨20min + è®­ç»ƒ30minï¼‰
- Day 2: è¿è¡Œè¿­ä»£4ï¼ˆå¦‚éœ€è¦ï¼‰
- Day 3: å¤§è§„æ¨¡è¯„ä¼°å’Œæµ‹è¯•

**é‡Œç¨‹ç¢‘**: æˆåŠŸç‡è¾¾åˆ°90%+

---

### **Week 4: ï¼ˆå¯é€‰ï¼‰PPOç²¾è°ƒ**
- Day 1-3: PPOè®­ç»ƒ
- Day 4-5: æœ€ç»ˆè¯„ä¼°å’Œæ–‡æ¡£

**é‡Œç¨‹ç¢‘**: æˆåŠŸç‡è¾¾åˆ°95%+

---

## ğŸ’¾ **æ•°æ®ç»„ç»‡ç»“æ„**

```
data/
â”œâ”€â”€ expert_demos/
â”‚   â””â”€â”€ round_0/
â”‚       â”œâ”€â”€ episode_0.npy
â”‚       â”œâ”€â”€ episode_1.npy
â”‚       â””â”€â”€ ...              # 10æ¬¡æ‰‹åŠ¨æ¼”ç¤º
â”‚
â”œâ”€â”€ policy_states/
â”‚   â”œâ”€â”€ iter_1/
â”‚   â”‚   â”œâ”€â”€ episode_0_fail.npy
â”‚   â”‚   â””â”€â”€ ...              # å¤±è´¥episodeçš„çŠ¶æ€
â”‚   â”œâ”€â”€ iter_2/
â”‚   â””â”€â”€ iter_3/
â”‚
â”œâ”€â”€ expert_labels/
â”‚   â”œâ”€â”€ iter_1.pkl           # ç¬¬1è½®æ ‡æ³¨
â”‚   â”œâ”€â”€ iter_2.pkl           # ç¬¬2è½®æ ‡æ³¨
â”‚   â””â”€â”€ iter_3.pkl
â”‚
â””â”€â”€ dagger_combined/
    â”œâ”€â”€ iter_1.pkl           # èšåˆæ•°æ®
    â”œâ”€â”€ iter_2.pkl
    â””â”€â”€ iter_3.pkl

checkpoints/
â”œâ”€â”€ bc_round_0.zip           # BCåŸºçº¿
â”œâ”€â”€ dagger_iter_1.zip        # DAggerç¬¬1è½®
â”œâ”€â”€ dagger_iter_2.zip        # DAggerç¬¬2è½®
â”œâ”€â”€ dagger_iter_3.zip        # DAggerç¬¬3è½®
â””â”€â”€ dagger_final.zip         # æœ€ç»ˆæ¨¡å‹
```

---

## ğŸ¯ **æˆåŠŸæŒ‡æ ‡**

### **æŠ€æœ¯æŒ‡æ ‡**
- âœ… BCåŸºçº¿æˆåŠŸç‡: â‰¥ 50%
- âœ… DAggerè¿­ä»£3æˆåŠŸç‡: â‰¥ 90%
- âœ… å¹³å‡è·å–æœ¨å¤´æ—¶é—´: < 300æ­¥
- âœ… ç­–ç•¥é²æ£’æ€§: åœ¨ä¸åŒåœ°å½¢/æ ‘ç§éƒ½èƒ½æˆåŠŸ

### **æ•ˆç‡æŒ‡æ ‡**
- âœ… æ€»å¼€å‘æ—¶é—´: < 3å‘¨
- âœ… æ€»æ ‡æ³¨æ—¶é—´: < 3å°æ—¶
- âœ… æ€»è®­ç»ƒæ—¶é—´: < 5å°æ—¶

---

## âš ï¸ **é£é™©å’Œç¼“è§£**

### **é£é™©1: BCåŸºçº¿å¤ªå·®ï¼ˆ<40%ï¼‰**
**ç¼“è§£**: 
- å¢åŠ ä¸“å®¶æ¼”ç¤ºåˆ°15-20æ¬¡
- ç¡®ä¿æ¼”ç¤ºè´¨é‡ï¼ˆéƒ½æ˜¯æˆåŠŸçš„ï¼‰
- è°ƒæ•´BCè¶…å‚æ•°ï¼ˆå­¦ä¹ ç‡ã€epochæ•°ï¼‰

---

### **é£é™©2: æ ‡æ³¨å¤ªè€—æ—¶**
**ç¼“è§£**:
- ä½¿ç”¨æ™ºèƒ½é‡‡æ ·ï¼ˆåªæ ‡æ³¨20-30%ï¼‰
- ä¸“æ³¨å¤±è´¥å‰5-10æ­¥
- ä½¿ç”¨å¿«æ·é”®åŠ é€Ÿæ ‡æ³¨

---

### **é£é™©3: è¿­ä»£æ”¶æ•›æ…¢**
**ç¼“è§£**:
- å¢åŠ æ¯è½®æ”¶é›†çš„episodeæ•°ï¼ˆ20â†’30ï¼‰
- æ ‡æ³¨æ›´å¤šå…³é”®çŠ¶æ€
- è°ƒæ•´è®­ç»ƒè¶…å‚æ•°

---

## ğŸ“ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**

### **ç«‹å³å¼€å§‹**:
1. âœ… å®ç° `tools/run_policy_collect_states.py`
2. âœ… å®ç° `tools/label_states.py`
3. âœ… å®ç° `src/training/train_bc.py`

### **æœ¬å‘¨å®Œæˆ**:
1. å½•åˆ¶10æ¬¡ä¸“å®¶æ¼”ç¤º
2. è®­ç»ƒBCåŸºçº¿
3. è¯„ä¼°å¹¶ç¡®è®¤â‰¥50%æˆåŠŸç‡

### **ä¸‹å‘¨å¼€å§‹**:
1. è¿è¡ŒDAggerè¿­ä»£1
2. è§‚å¯ŸæˆåŠŸç‡æå‡

---

## ğŸ”— **ç›¸å…³æ–‡æ¡£**

- [`DAGGER_DETAILED_GUIDE.md`](../guides/DAGGER_DETAILED_GUIDE.md) - DAggerç®—æ³•è¯¦è§£
- [`DAGGER_VS_BC_COMPARISON.md`](../guides/DAGGER_VS_BC_COMPARISON.md) - å¯è§†åŒ–å¯¹æ¯”
- [`IMITATION_LEARNING_GUIDE.md`](../guides/IMITATION_LEARNING_GUIDE.md) - æ¨¡ä»¿å­¦ä¹ æ¦‚è§ˆ
- [`IMITATION_LEARNING_ROADMAP.md`](IMITATION_LEARNING_ROADMAP.md) - æ€»ä½“è·¯çº¿å›¾

---

**æœ€åæ›´æ–°**: 2025-10-21  
**çŠ¶æ€**: ğŸ“ å‡†å¤‡é˜¶æ®µ â†’ å¼€å§‹å®ç°å·¥å…·

